<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Custom Cohere Reranker" href="../rerankers/cohere_custom_reranker.html" /><link rel="prev" title="Knowledge Distillation For Fine-Tuning A GPT-3.5 Judge (Pairwise)" href="../llm_judge/pairwise/finetune_llm_judge.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>How to Finetune a cross-encoder using LLamaIndex - LlamaIndex 🦙 0.9.8.post1</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/algolia.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style><script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="llamaindex-llamaindex" /><meta name="readthedocs-version-slug" content="stable" /></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">LlamaIndex 🦙 0.9.8.post1
</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">LlamaIndex 🦙 0.9.8.post1
</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/reading.html">How to read these docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/starter_example.html">Starter Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/concepts.html">High-Level Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/customization.html">Customization Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/discover_llamaindex.html">Discover LlamaIndex Video Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/q_and_a.html">Q&amp;A</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/chatbots.html">Chatbots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../use_cases/extraction.html">Structured Data Extraction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../use_cases/multimodal.html">Multi-modal</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../multi_modal/gpt4v_multi_modal_retrieval.html">Advanced Multi-Modal Retrieval using GPT4V and Multi-Modal Index/Retriever</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../multi_modal/multi_modal_retrieval.html">Multi-modal retrieval with CLIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../multi_modal/image_to_image_retrieval.html">Image to Image Retrieval</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../multi_modal/llava_multi_modal_tesla_10q.html">Retrieval-Augmented Image Captioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../multi_modal/ChromaMultiModalDemo.html">Chroma Multi-Modal Demo with LlamaIndex</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Understanding</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../understanding/understanding.html">Building an LLM application</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../understanding/using_llms/using_llms.html">Using LLMs</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../understanding/using_llms/privacy.html">Privacy and Security</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../understanding/loading/loading.html">Loading</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../understanding/loading/llamahub.html">LlamaHub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../understanding/indexing/indexing.html">Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../understanding/storing/storing.html">Storing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../understanding/querying/querying.html">Querying</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../understanding/putting_it_all_together/putting_it_all_together.html">Putting It All Together</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../understanding/putting_it_all_together/q_and_a.html">Q&amp;A patterns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/q_and_a/terms_definitions_tutorial.html">A Guide to Extracting Terms and Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/q_and_a/unified_query.html">A Guide to Creating a Unified Query Framework over your Indexes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/graphs.html">Knowledge Graphs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/structured_data.html">Structured Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/structured_data.html#a-guide-to-llamaindex-structured-data">A Guide to LlamaIndex + Structured Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/structured_data/Airbyte_demo.html">Airbyte SQL Index Guide</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../understanding/putting_it_all_together/apps.html">Full-Stack Web Application</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/apps/fullstack_app_guide.html">A Guide to Building a Full-Stack Web App with LLamaIndex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/putting_it_all_together/apps/fullstack_with_delphic.html">A Guide to Building a Full-Stack LlamaIndex Web App with Delphic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../understanding/putting_it_all_together/chatbots/building_a_chatbot.html">How to Build a Chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../understanding/putting_it_all_together/agents.html">Agents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../understanding/tracing_and_debugging/tracing_and_debugging.html">Tracing and Debugging</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../understanding/evaluating/evaluating.html">Evaluating</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../understanding/evaluating/cost_analysis/root.html">Cost Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../understanding/evaluating/cost_analysis/usage_pattern.html">Usage Pattern</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optimizing</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../optimizing/basic_strategies/basic_strategies.html">Basic Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/prompt_mixin.html">Accessing/Customizing Prompts within Higher-Level Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/advanced_prompts.html">Advanced Prompt Techniques (Variable Mappings, Functions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/advanced_prompts.html">Advanced Prompt Techniques (Variable Mappings, Functions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/prompts_rag.html">Prompt Engineering for RAG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../retrievers/bm25_retriever.html">BM25 Retriever</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../retrievers/reciprocal_rerank_fusion.html">Reciprocal Rerank Fusion Retriever</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vector_stores/WeaviateIndexDemo-Hybrid.html">Weaviate Vector Store - Hybrid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vector_stores/PineconeIndexDemo-Hybrid.html">Pinecone Vector Store - Hybrid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/indexing/vector_store_guide.html">Vector Store Index</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/loading/documents_and_nodes/usage_documents.html">Defining and Customizing Documents</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/loading/documents_and_nodes/usage_nodes.html">Defining and Customizing Nodes</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/loading/documents_and_nodes/usage_metadata_extractor.html">Metadata Extraction Usage Pattern</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../metadata_extraction/MetadataExtractionSEC.html">Extracting Metadata for Better Document Indexing and Understanding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../metadata_extraction/MetadataExtraction_LLMSurvey.html">Automated Metadata Extraction for Better Retrieval + Synthesis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../metadata_extraction/EntityExtractionClimate.html">Entity Metadata Extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../metadata_extraction/MarvinMetadataExtractorDemo.html">Metadata Extraction and Augmentation w/ Marvin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../metadata_extraction/PydanticExtractor.html">Pydantic Extractor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/advanced_retrieval.html">Advanced Retrieval Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/query_transformations.html">Query Transformations</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../query_transformations/HyDEQueryTransformDemo.html">HyDE Query Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_transformations/SimpleIndexDemo-multistep.html">Multi-Step Query Engine</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/structured_outputs/pydantic_program.html">Pydantic Program</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/openai_pydantic_program.html">OpenAI Pydantic Program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/guidance_pydantic_program.html">Guidance Pydantic Program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/guidance_sub_question.html">Guidance for Sub-Question Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/df_program.html">DataFrame Structured Data Extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/evaporate_program.html">Evaporate Demo</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/structured_outputs/query_engine.html">Query Engines + Pydantic Outputs</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/pydantic_query_engine.html">Query Engine with Pydantic Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../response_synthesizers/pydantic_tree_summarize.html">Pydantic Tree Summarize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../response_synthesizers/pydantic_tree_summarize.html#download-data">Download Data</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/structured_outputs/structured_outputs.html">Structured Outputs</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/structured_outputs/pydantic_program.html">Pydantic Program</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../output_parsing/openai_pydantic_program.html">OpenAI Pydantic Program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../output_parsing/guidance_pydantic_program.html">Guidance Pydantic Program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../output_parsing/guidance_sub_question.html">Guidance for Sub-Question Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../output_parsing/df_program.html">DataFrame Structured Data Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../output_parsing/evaporate_program.html">Evaporate Demo</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/structured_outputs/query_engine.html">Query Engines + Pydantic Outputs</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/pydantic_query_engine.html">Query Engine with Pydantic Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../response_synthesizers/pydantic_tree_summarize.html">Pydantic Tree Summarize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../response_synthesizers/pydantic_tree_summarize.html#download-data">Download Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../retrievers/deep_memory.html">DeepMemory (Activeloop)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../optimizing/agentic_strategies/agentic_strategies.html">Agentic strategies</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent.html">Build your own OpenAI Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_with_query_engine.html">OpenAI Agent with Query Engine Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_retrieval.html">Retrieval-Augmented OpenAI Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_query_cookbook.html">OpenAI Agent + Query Engine Experimental Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_query_plan.html">OpenAI Agent Query Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_context_retrieval.html">Context-Augmented OpenAI Agent</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../optimizing/evaluation/evaluation.html">Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/evaluation/e2e_evaluation.html">End-to-End Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/QuestionGeneration.html">QuestionGeneration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/batch_eval.html">BatchEvalRunner - Running Multiple Evaluations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/correctness_eval.html">Correctness Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/faithfulness_eval.html">Faithfulness Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/guideline_eval.html">Guideline Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/pairwise_eval.html">Pairwise Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/relevancy_eval.html">Relevancy Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/semantic_similarity_eval.html">Embedding Similarity Evaluator</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/evaluation/component_wise_evaluation.html">Component Wise Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/BeirEvaluation.html">BEIR Out of Domain Benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/HotpotQADistractor.html">HotpotQADistractor Demo</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/evaluating/root.html">Evaluating</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/evaluating/usage_pattern.html">Usage Pattern (Response Evaluation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/evaluating/usage_pattern_retrieval.html">Usage Pattern (Retrieval)</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/evaluating/modules.html">Modules</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/faithfulness_eval.html">Faithfulness Evaluator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/relevancy_eval.html">Relevancy Evaluator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/guideline_eval.html">Guideline Evaluator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/correctness_eval.html">Correctness Evaluator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/semantic_similarity_eval.html">Embedding Similarity Evaluator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/Deepeval.html">LlamaIndex + DeepEval Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/QuestionGeneration.html">QuestionGeneration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/batch_eval.html">BatchEvalRunner - Running Multiple Evaluations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/multi_modal/multi_modal_rag_evaluation.html">Evaluating Multi-Modal RAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/retrieval/retriever_eval.html">Retrieval Evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/evaluation/component_wise_evaluation.html">Component Wise Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/BeirEvaluation.html">BEIR Out of Domain Benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/HotpotQADistractor.html">HotpotQADistractor Demo</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../optimizing/evaluation/e2e_evaluation.html">End-to-End Evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/QuestionGeneration.html">QuestionGeneration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/batch_eval.html">BatchEvalRunner - Running Multiple Evaluations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/correctness_eval.html">Correctness Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/faithfulness_eval.html">Faithfulness Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/guideline_eval.html">Guideline Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/pairwise_eval.html">Pairwise Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/relevancy_eval.html">Relevancy Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/semantic_similarity_eval.html">Embedding Similarity Evaluator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../../optimizing/fine-tuning/fine-tuning.html">Fine-tuning</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../embeddings/finetune_embedding_adapter.html">Fine-tuning an Adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embeddings/finetune_embedding.html">Embedding Fine-tuning Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../router/router_finetune.html">Router Fine-tuning</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/run-llama/finetune-embedding">Embedding Fine-tuning Repo</a></li>
<li class="toctree-l2"><a class="reference external" href="https://medium.com/llamaindex-blog/fine-tuning-embeddings-for-rag-with-synthetic-data-e534409a3971">Embedding Fine-tuning Blog</a></li>
<li class="toctree-l2"><a class="reference external" href="https://colab.research.google.com/drive/1NgyCJVyrC2xcZ5lxt2frTU862v6eJHlc?usp=sharing">GPT-3.5 Fine-tuning Notebook (Colab)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openai_fine_tuning.html">GPT-3.5 Fine-tuning Notebook (Notebook link)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../react_agent/react_agent_finetune.html">Fine-tuning a gpt-3.5 ReAct Agent on Better Chain of Thought</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openai_fine_tuning_functions.html">[WIP] Function Calling Fine-tuning</a></li>
<li class="toctree-l2"><a class="reference external" href="https://colab.research.google.com/drive/1vWeJBXdFEObuihO7Z8ui2CAYkdHQORqo?usp=sharing">GPT-3.5 Fine-tuning Notebook (Colab)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/jerryjliu/llama_index/blob/main/experimental/openai_fine_tuning/openai_fine_tuning.ipynb">GPT-3.5 Fine-tuning Notebook (in Repo)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../knowledge/finetune_retrieval_aug.html">Fine-tuning with Retrieval Augmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openai_fine_tuning_functions.html">OpenAI Function Calling Fine-tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gradient/gradient_structured.html">Llama2 Structured Output Fine-tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../knowledge/finetune_knowledge.html">Fine-tuning to Memorize Knowledge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gradient/gradient_fine_tuning.html">Llama 2 Text-to-SQL Fine-tuning (w/ Gradient.AI)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/run-llama/modal_finetune_sql">Llama 2 Text-to-SQL Fine-tuning (w/ Modal, Repo)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/run-llama/modal_finetune_sql/blob/main/tutorial.ipynb">Llama 2 Text-to-SQL Fine-tuning (w/ Modal, Notebook)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../llm_judge/correctness/finetune_llm_judge_single_grading_correctness.html">Knowledge Distillation For Fine-Tuning A GPT-3.5 Judge (Correctness)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../llm_judge/pairwise/finetune_llm_judge.html">Knowledge Distillation For Fine-Tuning A GPT-3.5 Judge (Pairwise)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Cross-Encoder Finetuning</a></li>
<li class="toctree-l2"><a class="reference external" href="https://medium.com/llamaindex-blog/easily-finetune-llama-2-for-your-text-to-sql-applications-ecd53640e10d">Finetuning Llama 2 for Text-to-SQL</a></li>
<li class="toctree-l2"><a class="reference external" href="https://colab.research.google.com/drive/1vWeJBXdFEObuihO7Z8ui2CAYkdHQORqo?usp=sharing">Finetuning GPT-3.5 to Distill GPT-4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rerankers/cohere_custom_reranker.html">Cohere Custom Reranker</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../optimizing/production_rag.html">Building Performant RAG Applications for Production</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../query_engine/pdf_tables/recursive_retriever.html">Recursive Retriever + Query Engine Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index_structs/doc_summary/DocSummary.html">Document Summary Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../node_postprocessor/MetadataReplacementDemo.html">Metadata Replacement + Node Sentence Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vector_stores/chroma_auto_retriever.html">Auto-Retrieval from a Vector Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index_structs/doc_summary/DocSummary.html">Document Summary Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_engine/recursive_retriever_agents.html">Recursive Retriever + Document Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../retrievers/auto_vs_recursive_retriever.html">Comparing Methods for Structured Retrieval (Auto-Retrieval vs. Recursive Retrieval)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_engine/sub_question_query_engine.html">Sub Question Query Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_engine/JointQASummary.html">Joint QA Summary Query Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_engine/recursive_retriever_agents.html">Recursive Retriever + Document Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_engine/RouterQueryEngine.html">Router Query Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_query_cookbook.html">OpenAI Agent + Query Engine Experimental Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agent/openai_agent_query_plan.html">OpenAI Agent Query Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embeddings/finetune_embedding.html">Embedding Fine-tuning Guide</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../optimizing/building_rag_from_scratch.html">Building RAG from Scratch (Lower-Level)</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/ingestion.html">Building Data Ingestion from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/ingestion.html#pinecone">Pinecone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/ingestion.html#openai">OpenAI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/retrieval.html">Building Retrieval from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/oss_ingestion_retrieval.html">Building RAG from Scratch (Open-source only!)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/vector_store.html">Building a (Very Simple) Vector Store from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/response_synthesis.html">Building Response Synthesis from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/evaluation.html">Building Evaluation from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/router.html">Building a Router from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../low_level/fusion_retriever.html">Building an Advanced Fusion Retriever from Scratch</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module Guides</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/models/models.html">Models</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/models/llms.html">Using LLMs</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/models/llms/usage_standalone.html">Using LLMs as standalone modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/models/llms/usage_custom.html">Customizing LLMs within LlamaIndex Abstractions</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/models/llms/modules.html">Available LLM integrations</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../llm/openai.html">OpenAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/azure_openai.html">Azure OpenAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/ai21.html">AI21</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/anthropic.html">Anthropic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/gradient_base_model.html">Gradient Base Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/gradient_model_adapter.html">Gradient Model Adapter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../customization/llms/SimpleIndexDemo-Huggingface_camel.html">HuggingFace LLM - Camel-5b</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../customization/llms/SimpleIndexDemo-Huggingface_stablelm.html">HuggingFace LLM - StableLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../vector_stores/SimpleIndexDemoLlama-Local.html">Local Llama2 + VectorStoreIndex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/everlyai.html">EverlyAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/litellm.html">LiteLLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/palm.html">PaLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/predibase.html">Predibase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/llama_2.html">Replicate - Llama 2 13B</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/vicuna.html">Replicate - Vicuna 13B</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../vector_stores/SimpleIndexDemoLlama2.html">Llama2 + VectorStoreIndex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/langchain.html">LangChain LLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/llama_api.html">Llama API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/llama_2_llama_cpp.html">LlamaCPP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/xinference_local_deployment.html">Xorbits Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/monsterapi.html">Monster API LLM Integration into LLamaIndex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/rungpt.html">RunGPT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/rungpt.html#setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/portkey.html">Portkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/anyscale.html">Anyscale</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/ollama.html">Ollama - Llama 2 7B</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/clarifai.html">Clarifai LLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/bedrock.html">Bedrock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/bedrock.html#connect-to-bedrock-with-access-keys">Connect to Bedrock with Access Keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/vertex.html">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/vertex.html#streaming-usage">Streaming Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/vertex.html#chat-usage">Chat Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/vertex.html#async-chat">Async Chat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/vertex.html#streaming-chat">Streaming Chat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/perplexity.html">Perplexity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../llm/openllm.html">OpenLLM</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/models/embeddings.html">Embeddings</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/OpenAI.html">OpenAI Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/Langchain.html">Langchain Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/cohereai.html">CohereAI Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/fastembed.html">Qdrant FastEmbed Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/gradient.html">Gradient Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../customization/llms/AzureOpenAI.html">Azure OpenAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/custom_embeddings.html">Custom Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/huggingface.html">Local Embeddings with HuggingFace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/elasticsearch.html">Elasticsearch Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/clarifai.html">Embeddings with Clarifai</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/llm_rails.html">LLMRails Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/text_embedding_inference.html">Text Embedding Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/google_palm.html">Google PaLM Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/jinaai_embeddings.html">Jina Embeddings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../embeddings/voyageai.html">Voyage Embeddings</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/models/prompts.html">Prompts</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../module_guides/models/prompts/usage_pattern.html">Usage Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../customization/prompts/completion_prompts.html">Completion prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../customization/prompts/chat_prompts.html">Chat prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../prompts/prompt_mixin.html">Accessing/Customizing Prompts within Higher-Level Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../prompts/advanced_prompts.html">Advanced Prompt Techniques (Variable Mappings, Functions)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../prompts/prompts_rag.html">Prompt Engineering for RAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../prompts/prompt_optimization.html">“Optimization by Prompting” for RAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../prompts/emotion_prompt.html">EmotionPrompt in RAG</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/models/llms/local.html">Using local models</a></li>
<li class="toctree-l3"><a class="reference external" href="https://replicate.com/blog/run-llama-locally">Run Llama2 locally</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/models/embeddings.html">Embeddings</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/OpenAI.html">OpenAI Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/Langchain.html">Langchain Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/cohereai.html">CohereAI Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/fastembed.html">Qdrant FastEmbed Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/gradient.html">Gradient Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../customization/llms/AzureOpenAI.html">Azure OpenAI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/custom_embeddings.html">Custom Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/huggingface.html">Local Embeddings with HuggingFace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/elasticsearch.html">Elasticsearch Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/clarifai.html">Embeddings with Clarifai</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/llm_rails.html">LLMRails Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/text_embedding_inference.html">Text Embedding Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/google_palm.html">Google PaLM Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/jinaai_embeddings.html">Jina Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../embeddings/voyageai.html">Voyage Embeddings</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/models/multi_modal.html">[Beta] Multi-modal models</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/openai_multi_modal.html">Multi-Modal LLM using OpenAI GPT-4V model for image reasoning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/replicate_multi_modal.html">Multi-Modal LLM using Replicate LlaVa, Fuyu 8B, MiniGPT4 models for image reasoning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/multi_modal_retrieval.html">Multi-Modal Retrieval using GPT text embedding and CLIP image embedding for Wikipedia Articles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/llava_multi_modal_tesla_10q.html">Retrieval-Augmented Image Captioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/image_to_image_retrieval.html">Image to Image Retrieval using CLIP embedding and image correlation reasoning using GPT4V</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/gpt4v_multi_modal_retrieval.html">Advanced Multi-Modal Retrieval using GPT4V and Multi-Modal Index/Retriever</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/gpt4v_experiments_cot.html">GPT4-V Experiments with General, Specific questions and Chain Of Thought (COT) Prompting Technique.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multi_modal/ChromaMultiModalDemo.html">Chroma Multi-Modal Demo with LlamaIndex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/multi_modal/multi_modal_rag_evaluation.html">Evaluating Multi-Modal RAG</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/models/prompts.html">Prompts</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/models/prompts/usage_pattern.html">Usage Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customization/prompts/completion_prompts.html">Completion prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customization/prompts/chat_prompts.html">Chat prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/prompt_mixin.html">Accessing/Customizing Prompts within Higher-Level Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/advanced_prompts.html">Advanced Prompt Techniques (Variable Mappings, Functions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/prompts_rag.html">Prompt Engineering for RAG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/prompt_optimization.html">“Optimization by Prompting” for RAG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prompts/emotion_prompt.html">EmotionPrompt in RAG</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/loading/loading.html">Loading</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/loading/connector/root.html">Data Connectors (LlamaHub)</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/loading/connector/usage_pattern.html">Usage Pattern</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/loading/connector/modules.html">Module Guides</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/simple_directory_reader.html">Simple Directory Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/PsychicDemo.html">Psychic Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/DeepLakeReader.html">DeepLake Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/QdrantDemo.html">Qdrant Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/DiscordDemo.html">Discord Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/MongoDemo.html">MongoDB Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/ChromaDemo.html">Chroma Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/MyScaleReaderDemo.html">MyScale Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/FaissDemo.html">Faiss Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/ObsidianReaderDemo.html">Obsidian Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/SlackDemo.html">Slack Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/WebPageDemo.html">Web Page Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/PineconeDemo.html">Pinecone Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/MboxReaderDemo.html">Mbox Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/MilvusReaderDemo.html">MilvusReader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/NotionDemo.html">Notion Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/GithubRepositoryReaderDemo.html">Github Repo Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/GoogleDocsDemo.html">Google Docs Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/DatabaseReaderDemo.html">Database Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/TwitterDemo.html">Twitter Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/WeaviateDemo.html">Weaviate Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/MakeDemo.html">Make Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../data_connectors/deplot/DeplotReader.html">Deplot Reader Demo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/loading/documents_and_nodes/root.html">Documents / Nodes</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/loading/documents_and_nodes/usage_documents.html">Defining and Customizing Documents</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/loading/documents_and_nodes/usage_nodes.html">Defining and Customizing Nodes</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/loading/node_parsers/root.html">Node Parser Usage Pattern</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/loading/node_parsers/modules.html">Node Parser Modules</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/loading/ingestion_pipeline/root.html">Ingestion Pipeline</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/loading/ingestion_pipeline/transformations.html">Transformations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/indexing/indexing.html">Indexing</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/indexing/index_guide.html">How Each Index Works</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/indexing/usage_pattern.html">Usage Pattern</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/indexing/metadata_extraction.html">Metadata Extraction</a><input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" role="switch" type="checkbox"/><label for="toctree-checkbox-47"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../metadata_extraction/MetadataExtractionSEC.html">Extracting Metadata for Better Document Indexing and Understanding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../metadata_extraction/MetadataExtraction_LLMSurvey.html">Automated Metadata Extraction for Better Retrieval + Synthesis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../metadata_extraction/EntityExtractionClimate.html">Entity Metadata Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../metadata_extraction/MarvinMetadataExtractorDemo.html">Metadata Extraction and Augmentation w/ Marvin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../metadata_extraction/PydanticExtractor.html">Pydantic Extractor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/indexing/document_management.html">Document Management</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/indexing/modules.html">Module Guides</a><input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" role="switch" type="checkbox"/><label for="toctree-checkbox-48"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/indexing/vector_store_guide.html">Vector Store Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/indexing/index_guide.html">Summary Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/indexing/index_guide.html">Tree Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/indexing/index_guide.html">Keyword Table Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/KnowledgeGraphDemo.html">Knowledge Graph Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/KnowledgeGraphIndex_vs_VectorStoreIndex_vs_CustomIndex_combined.html">Custom Retriever combining KG Index and VectorStore Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/knowledge_graph_query_engine.html">Knowledge Graph Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/knowledge_graph_rag_query_engine.html">Knowledge Graph RAG Query Engine</a></li>
<li class="toctree-l3"><a class="reference external" href="https://colab.research.google.com/drive/1G6pcR0pXvSkdMQlAK_P-IrYgo-_staxd?usp=sharing">REBEL + Knowledge Graph Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/knowledge_graph2.html">REBEL + Wikipedia Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/struct_indices/SQLIndexDemo.html">SQL Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/struct_indices/duckdb_sql_query.html">SQL Query Engine with LlamaIndex + DuckDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/doc_summary/DocSummary.html">Document Summary Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../objects/object_index.html">The <code class="docutils literal notranslate"><span class="pre">ObjectIndex</span></code> Class</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/indexing/composability.html">Composability</a><input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" role="switch" type="checkbox"/><label for="toctree-checkbox-49"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../composable_indices/ComposableIndices-Prior.html">Composable Graph Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../composable_indices/ComposableIndices-Weaviate.html">Composable Graph with Weaviate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../composable_indices/ComposableIndices.html">Composable Graph</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/storing/storing.html">Storing</a><input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" role="switch" type="checkbox"/><label for="toctree-checkbox-50"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/storing/customization.html">Customizing Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/storing/save_load.html">Persisting &amp; Loading Data</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/storing/vector_stores.html">Vector Stores</a><input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" role="switch" type="checkbox"/><label for="toctree-checkbox-51"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/AstraDBIndexDemo.html">Astra DB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/AsyncIndexCreationDemo.html">Simple Vector Store - Async Index Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/AzureCosmosDBMongoDBvCoreDemo.html">Azure CosmosDB MongoDB Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CassandraIndexDemo.html">Cassandra Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ChromaIndexDemo.html">Chroma</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html">Azure Cognitive Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#basic-example">Basic Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#create-index-if-it-does-not-exist">Create Index (if it does not exist)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#use-existing-index">Use Existing Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#adding-a-document-to-existing-index">Adding a document to existing index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#filtering">Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DashvectorIndexDemo.html">DashVector Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DeepLakeIndexDemo.html">DeepLake Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DocArrayHnswIndexDemo.html">DocArray Hnsw Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DocArrayInMemoryIndexDemo.html">DocArray InMemory Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/EpsillaIndexDemo.html">Epsilla Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/LanceDBIndexDemo.html">LanceDB Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MetalIndexDemo.html">Metal Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MilvusIndexDemo.html">Milvus Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MyScaleIndexDemo.html">MyScale Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ElasticsearchIndexDemo.html">Elasticsearch Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/FaissIndexDemo.html">Faiss Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MongoDBAtlasVectorSearch.html">MongoDB Atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/Neo4jVectorDemo.html">Neo4j vector store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/OpensearchDemo.html">Opensearch Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/PineconeIndexDemo.html">Pinecone Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/PineconeIndexDemo-Hybrid.html">Pinecone Vector Store - Hybrid Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/PGVectoRsDemo.html">pgvecto.rs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/postgres.html">Postgres Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RedisIndexDemo.html">Redis Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RedisIndexDemo.html#query-the-data">Query the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RedisIndexDemo.html#working-with-metadata">Working with Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/QdrantIndexDemo.html">Qdrant Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RocksetIndexDemo.html">Rockset Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/SimpleIndexDemo.html">Simple Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/SupabaseVectorIndexDemo.html">Supabase Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/TairIndexDemo.html">Tair Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/TencentVectorDBIndexDemo.html">Tencent Cloud VectorDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/Timescalevector.html">Timescale Vector Store (PostgreSQL)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/WeaviateIndexDemo.html">Weaviate Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/WeaviateIndexDemo-Hybrid.html">Weaviate Vector Store - Hybrid Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ZepIndexDemo.html">Zep Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ZepIndexDemo.html#create-a-zep-vector-store-and-index">Create a Zep Vector Store and Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ZepIndexDemo.html#querying-with-metadata-filters">Querying with Metadata filters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/storing/docstores.html">Document Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/storing/index_stores.html">Index Stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/storing/kv_stores.html">Key-Value Stores</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../community/integrations/graph_stores.html">Using Graph Stores</a><input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" role="switch" type="checkbox"/><label for="toctree-checkbox-52"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/Neo4jKGIndexDemo.html">Neo4j Graph Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/NebulaGraphKGIndexDemo.html">Nebula Graph Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/knowledge_graph_query_engine.html">Knowledge Graph Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/KuzuGraphDemo.html">Kuzu Graph Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/FalkorDBGraphDemo.html">FalkorDB Graph Store</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/querying/querying.html">Querying</a><input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" role="switch" type="checkbox"/><label for="toctree-checkbox-53"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/deploying/query_engine/root.html">Query Engine</a><input class="toctree-checkbox" id="toctree-checkbox-54" name="toctree-checkbox-54" role="switch" type="checkbox"/><label for="toctree-checkbox-54"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/deploying/query_engine/usage_pattern.html">Usage Pattern</a><input class="toctree-checkbox" id="toctree-checkbox-55" name="toctree-checkbox-55" role="switch" type="checkbox"/><label for="toctree-checkbox-55"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../module_guides/deploying/query_engine/response_modes.html">Response Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../module_guides/deploying/query_engine/streaming.html">Streaming</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/deploying/query_engine/modules.html">Module Guides</a><input class="toctree-checkbox" id="toctree-checkbox-56" name="toctree-checkbox-56" role="switch" type="checkbox"/><label for="toctree-checkbox-56"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/custom_query_engine.html">Custom Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/CustomRetrievers.html">Retriever Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index_structs/struct_indices/SQLIndexDemo.html">Text-to-SQL Guide (Query Engine + Retriever)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/json_query_engine.html">JSON Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/pandas_query_engine.html">Pandas Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/knowledge_graph_query_engine.html">Knowledge Graph Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/knowledge_graph_rag_query_engine.html">Knowledge Graph RAG Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/RouterQueryEngine.html">Router Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/RetrieverRouterQueryEngine.html">Retriever Router Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/JointQASummary.html">Joint QA Summary Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/sub_question_query_engine.html">Sub Question Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_transformations/SimpleIndexDemo-multistep.html">Multi-Step Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/SQLRouterQueryEngine.html">SQL Router Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/SQLAutoVectorQueryEngine.html">SQL Auto Vector Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/SQLJoinQueryEngine.html">SQL Join Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/pgvector_sql_query_engine.html">[Beta] Text-to-SQL with PGVector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index_structs/struct_indices/duckdb_sql_query.html">SQL Query Engine with LlamaIndex + DuckDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../evaluation/RetryQuery.html">Retry Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/citation_query_engine.html">CitationQueryEngine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/pdf_tables/recursive_retriever.html">Recursive Retriever + Query Engine Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/sec_tables/tesla_10q_table.html">Joint Tabular/Semantic QA over Tesla 10K</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/recursive_retriever_agents.html">Recursive Retriever + Document Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/ensemble_query_engine.html">Ensemble Query Engine Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/sub_question_query_engine.html">Sub Question Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/recursive_retriever_agents.html">Recursive Retriever + Document Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/multi_document_agents.html">Multi-Document Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/multi_document_agents-v1.html">Multi-Document Agents (V1)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/flare_query_engine.html">FLARE Query Engine</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/deploying/query_engine/supporting_modules.html">Supporting Modules</a><input class="toctree-checkbox" id="toctree-checkbox-57" name="toctree-checkbox-57" role="switch" type="checkbox"/><label for="toctree-checkbox-57"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../optimizing/advanced_retrieval/query_transformations.html">Query Transformations</a><input class="toctree-checkbox" id="toctree-checkbox-58" name="toctree-checkbox-58" role="switch" type="checkbox"/><label for="toctree-checkbox-58"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../query_transformations/HyDEQueryTransformDemo.html">HyDE Query Transform</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../query_transformations/SimpleIndexDemo-multistep.html">Multi-Step Query Engine</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/deploying/chat_engines/root.html">Chat Engine</a><input class="toctree-checkbox" id="toctree-checkbox-59" name="toctree-checkbox-59" role="switch" type="checkbox"/><label for="toctree-checkbox-59"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/deploying/chat_engines/usage_pattern.html">Usage Pattern</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/deploying/chat_engines/modules.html">Module Guides</a><input class="toctree-checkbox" id="toctree-checkbox-60" name="toctree-checkbox-60" role="switch" type="checkbox"/><label for="toctree-checkbox-60"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../chat_engine/chat_engine_react.html">ReAct Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../chat_engine/chat_engine_openai.html">OpenAI Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../chat_engine/chat_engine_condense_question.html">Condense Question Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../chat_engine/chat_engine_context.html">Context Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../chat_engine/chat_engine_condense_plus_context.html">Context Plus Condense Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../chat_engine/chat_engine_repl.html">Simple Chat Engine</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/deploying/agents/root.html">Data Agents</a><input class="toctree-checkbox" id="toctree-checkbox-61" name="toctree-checkbox-61" role="switch" type="checkbox"/><label for="toctree-checkbox-61"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/deploying/agents/usage_pattern.html">Usage Pattern</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/deploying/agents/modules.html">Module Guides</a><input class="toctree-checkbox" id="toctree-checkbox-62" name="toctree-checkbox-62" role="switch" type="checkbox"/><label for="toctree-checkbox-62"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent.html">Build your own OpenAI Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent_with_query_engine.html">OpenAI Agent with Query Engine Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent_retrieval.html">Retrieval-Augmented OpenAI Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent_query_cookbook.html">OpenAI Agent + Query Engine Experimental Cookbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent_query_plan.html">OpenAI Agent Query Planning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent_context_retrieval.html">Context-Augmented OpenAI Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/recursive_retriever_agents.html">Recursive Retriever + Document Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/multi_document_agents.html">Multi-Document Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/agent_builder.html">GPT Builder Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_agent_parallel_function_calling.html">Single-Turn Multi-Function Calling OpenAI Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_assistant_agent.html">OpenAI Assistant Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_retrieval_benchmark.html">Benchmarking OpenAI Retrieval API (through Assistant Agent)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/openai_assistant_query_cookbook.html">OpenAI Assistant Advanced Retrieval Cookbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agent/react_agent_with_query_engine.html">ReAct Agent with Query Engine Tools</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/deploying/agents/tools/root.html">Tools</a><input class="toctree-checkbox" id="toctree-checkbox-63" name="toctree-checkbox-63" role="switch" type="checkbox"/><label for="toctree-checkbox-63"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../module_guides/deploying/agents/tools/usage_pattern.html">Usage Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../module_guides/deploying/agents/tools/llamahub_tools_guide.html">LlamaHub Tools Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/querying/retriever/root.html">Retriever</a><input class="toctree-checkbox" id="toctree-checkbox-64" name="toctree-checkbox-64" role="switch" type="checkbox"/><label for="toctree-checkbox-64"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/querying/retriever/retriever_modes.html">Retriever Modes</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/querying/retriever/retrievers.html">Retriever Modules</a><input class="toctree-checkbox" id="toctree-checkbox-65" name="toctree-checkbox-65" role="switch" type="checkbox"/><label for="toctree-checkbox-65"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/CustomRetrievers.html">Define Custom Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/bm25_retriever.html">BM25 Hybrid Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/simple_fusion.html">Simple Fusion Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/reciprocal_rerank_fusion.html">Reciprocal Rerank Fusion Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index_structs/knowledge_graph/KnowledgeGraphIndex_vs_VectorStoreIndex_vs_CustomIndex_combined.html">Custom Retriever (KG Index and Vector Store Index)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/knowledge_graph_rag_query_engine.html">Knowledge Graph RAG Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/simple_fusion.html">Simple Fusion Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/reciprocal_rerank_fusion.html">Reciprocal Rerank Fusion Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../vector_stores/chroma_auto_retriever.html">Auto-Retrieval (with Chroma)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../vector_stores/BagelAutoRetriever.html">Auto-Retrieval (with BagelDB)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_engine/pdf_tables/recursive_retriever.html">Recursive Retriever + Query Engine Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/router_retriever.html">Router Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/ensemble_retrieval.html">Ensemble Retrieval Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/auto_merging_retriever.html">Auto Merging Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/recursive_retriever_nodes.html">Recursive Retriever + Node References</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/recurisve_retriever_nodes_braintrust.html">Recursive Retriever + Node References + Braintrust</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/MetadataReplacementDemo.html">Metadata Replacement + Node Sentence Window</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../index_structs/struct_indices/SQLIndexDemo.html">Text-to-SQL Guide (Query Engine + Retriever)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../retrievers/deep_memory.html">DeepMemory (Activeloop)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/querying/response_synthesizers/root.html">Response Synthesizer</a><input class="toctree-checkbox" id="toctree-checkbox-66" name="toctree-checkbox-66" role="switch" type="checkbox"/><label for="toctree-checkbox-66"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/querying/response_synthesizers/response_synthesizers.html">Response Synthesis Modules</a><input class="toctree-checkbox" id="toctree-checkbox-67" name="toctree-checkbox-67" role="switch" type="checkbox"/><label for="toctree-checkbox-67"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../response_synthesizers/refine.html">Refine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../response_synthesizers/structured_refine.html">Refine with Structured Answer Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../response_synthesizers/tree_summarize.html">Tree Summarize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../response_synthesizers/custom_prompt_synthesizer.html">Pydantic Tree Summarize</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/querying/router/root.html">Routers</a><input class="toctree-checkbox" id="toctree-checkbox-68" name="toctree-checkbox-68" role="switch" type="checkbox"/><label for="toctree-checkbox-68"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/RouterQueryEngine.html">Router Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/RetrieverRouterQueryEngine.html">Retriever Router Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/SQLRouterQueryEngine.html">SQL Router Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../retrievers/router_retriever.html">Router Retriever</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/querying/node_postprocessors/root.html">Node Postprocessor</a><input class="toctree-checkbox" id="toctree-checkbox-69" name="toctree-checkbox-69" role="switch" type="checkbox"/><label for="toctree-checkbox-69"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/querying/node_postprocessors/node_postprocessors.html">Node Postprocessor Modules</a><input class="toctree-checkbox" id="toctree-checkbox-70" name="toctree-checkbox-70" role="switch" type="checkbox"/><label for="toctree-checkbox-70"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/OptimizerDemo.html">Sentence Embedding Optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/CohereRerank.html">Cohere Rerank</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/LLMReranker-Lyft-10k.html">LLM Reranker Demonstration (2021 Lyft 10-k)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/LLMReranker-Gatsby.html">LLM Reranker Demonstration (Great Gatsby)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/RecencyPostprocessorDemo.html">Recency Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/TimeWeightedPostprocessorDemo.html">Time-Weighted Rerank</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/PII.html">PII Masking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/PrevNextPostprocessorDemo.html">Forward/Backward Augmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/MetadataReplacementDemo.html">Metadata Replacement + Node Sentence Window</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../node_postprocessor/LongContextReorder.html">LongContextReorder</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/querying/output_parser.html">Output Parsing Modules</a><input class="toctree-checkbox" id="toctree-checkbox-71" name="toctree-checkbox-71" role="switch" type="checkbox"/><label for="toctree-checkbox-71"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/GuardrailsDemo.html">Guardrails Output Parsing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/LangchainOutputParserDemo.html">Langchain Output Parsing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/guidance_pydantic_program.html">Guidance Pydantic Program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/guidance_sub_question.html">Guidance for Sub-Question Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../output_parsing/openai_pydantic_program.html">OpenAI Pydantic Program</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/observability/observability.html">Observability</a><input class="toctree-checkbox" id="toctree-checkbox-72" name="toctree-checkbox-72" role="switch" type="checkbox"/><label for="toctree-checkbox-72"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../callbacks/WandbCallbackHandler.html">Wandb Callback Handler</a></li>
<li class="toctree-l2"><a class="reference external" href="https://colab.research.google.com/github/Arize-ai/phoenix/blob/main/tutorials/tracing/llama_index_tracing_tutorial.ipynb">Arize Phoenix Tracing Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../callbacks/OpenInferenceCallback.html">OpenInference Callback Handler + Arize Phoenix</a></li>
<li class="toctree-l2"><a class="reference external" href="https://colab.research.google.com/github/Arize-ai/phoenix/blob/main/tutorials/llama_index_search_and_retrieval_tutorial.ipynb">Evaluating Search and Retrieval with Arize Phoenix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/trulens.html">Evaluating and Tracking with TruLens</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/truera/trulens/blob/main/trulens_eval/examples/frameworks/llama_index/llama_index_quickstart.ipynb">Quickstart Guide with LlamaIndex + TruLens</a></li>
<li class="toctree-l2"><a class="reference external" href="https://colab.research.google.com/github/truera/trulens/blob/main/trulens_eval/examples/frameworks/llama_index/llama_index_quickstart.ipynb">Colab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../callbacks/HoneyHiveLlamaIndexTracer.html">HoneyHive LlamaIndex Tracer</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/observability/callbacks/root.html">Callbacks</a><input class="toctree-checkbox" id="toctree-checkbox-73" name="toctree-checkbox-73" role="switch" type="checkbox"/><label for="toctree-checkbox-73"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/TokenCountingHandler.html">Token Counting Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/LlamaDebugHandler.html">Llama Debug Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/WandbCallbackHandler.html">Wandb Callback Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/AimCallback.html">Aim Callback</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/OpenInferenceCallback.html">OpenInference Callback Handler + Arize Phoenix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../module_guides/observability/callbacks/token_counting_migration.html">Token Counting - Migration Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/evaluating/root.html">Evaluating</a><input class="toctree-checkbox" id="toctree-checkbox-74" name="toctree-checkbox-74" role="switch" type="checkbox"/><label for="toctree-checkbox-74"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/evaluating/usage_pattern.html">Usage Pattern (Response Evaluation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/evaluating/usage_pattern_retrieval.html">Usage Pattern (Retrieval)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/evaluating/modules.html">Modules</a><input class="toctree-checkbox" id="toctree-checkbox-75" name="toctree-checkbox-75" role="switch" type="checkbox"/><label for="toctree-checkbox-75"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/faithfulness_eval.html">Faithfulness Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/relevancy_eval.html">Relevancy Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/guideline_eval.html">Guideline Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/correctness_eval.html">Correctness Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/semantic_similarity_eval.html">Embedding Similarity Evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/Deepeval.html">LlamaIndex + DeepEval Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/QuestionGeneration.html">QuestionGeneration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/batch_eval.html">BatchEvalRunner - Running Multiple Evaluations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/multi_modal/multi_modal_rag_evaluation.html">Evaluating Multi-Modal RAG</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../evaluation/retrieval/retriever_eval.html">Retrieval Evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/supporting_modules/supporting_modules.html">Supporting Modules</a><input class="toctree-checkbox" id="toctree-checkbox-76" name="toctree-checkbox-76" role="switch" type="checkbox"/><label for="toctree-checkbox-76"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/supporting_modules/service_context.html">ServiceContext</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api_reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-77" name="toctree-checkbox-77" role="switch" type="checkbox"/><label for="toctree-checkbox-77"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/callbacks.html">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/composability.html">Composability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/evaluation.html">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/example_notebooks.html">Example Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/finetuning.html">Finetuning</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/indices.html">Indices</a><input class="toctree-checkbox" id="toctree-checkbox-78" name="toctree-checkbox-78" role="switch" type="checkbox"/><label for="toctree-checkbox-78"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/list.html">Summary Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/table.html">Table Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/tree.html">Tree Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/vector_store.html">Vector Store Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/struct_store.html">Structured Store Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/kg.html">Knowledge Graph Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/indices/empty.html">Empty Index</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/llm_predictor.html">LLM Predictors</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/llms.html">LLMs</a><input class="toctree-checkbox" id="toctree-checkbox-79" name="toctree-checkbox-79" role="switch" type="checkbox"/><label for="toctree-checkbox-79"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/openai.html">OpenAI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/azure_openai.html">Azure OpenAI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/huggingface.html">HuggingFaceLLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/langchain.html">LangChainLLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/anthropic.html">Anthropic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/gradient_base_model.html">Gradient Base Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/gradient_model_adapter.html">Gradient Model Adapter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/litellm.html">LiteLLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/llama_cpp.html">LlamaCPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/palm.html">PaLM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/predibase.html">Predibase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/replicate.html">Replicate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/xinference.html">XOrbits Xinference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/llms/openllm.html">OpenLLM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/memory.html">Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/node_postprocessor.html">Node Postprocessor</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/node.html">Node</a><input class="toctree-checkbox" id="toctree-checkbox-80" name="toctree-checkbox-80" role="switch" type="checkbox"/><label for="toctree-checkbox-80"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.BaseComponent.html">BaseComponent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.BaseNode.html">BaseNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.Document.html">Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.ImageDocument.html">ImageDocument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.ImageNode.html">ImageNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.IndexNode.html">IndexNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.MetadataMode.html">MetadataMode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.Node.html">Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.NodeRelationship.html">NodeRelationship</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.NodeWithScore.html">NodeWithScore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.ObjectType.html">ObjectType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.QueryBundle.html">QueryBundle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.RelatedNodeInfo.html">RelatedNodeInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.TextNode.html">TextNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.schema.TransformComponent.html">TransformComponent</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/playground.html">Playground</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/prompts.html">Prompt Templates</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/query.html">Querying an Index</a><input class="toctree-checkbox" id="toctree-checkbox-81" name="toctree-checkbox-81" role="switch" type="checkbox"/><label for="toctree-checkbox-81"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api_reference/query/retrievers.html">Retrievers</a><input class="toctree-checkbox" id="toctree-checkbox-82" name="toctree-checkbox-82" role="switch" type="checkbox"/><label for="toctree-checkbox-82"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/empty.html">Empty Index Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/kg.html">Knowledge Graph Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/list.html">List Retriever</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/table.html">Keyword Table Retrievers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/tree.html">Tree Retrievers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/vector_store.html">Vector Store Retrievers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/retrievers/transform.html">Transform Retriever</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/query/response_synthesizer.html">Response Synthesizer</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api_reference/query/query_engines.html">Query Engines</a><input class="toctree-checkbox" id="toctree-checkbox-83" name="toctree-checkbox-83" role="switch" type="checkbox"/><label for="toctree-checkbox-83"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/graph_query_engine.html">Graph Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/multistep_query_engine.html">Multistep Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/retriever_query_engine.html">Retriever Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/transform_query_engine.html">Transform Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/router_query_engine.html">Router Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/retriever_router_query_engine.html">Retriever Router Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/sub_question_query_engine.html">Sub Question Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/sql_join_query_engine.html">SQL Join Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/flare_query_engine.html">Flare Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/citation_query_engine.html">Citation Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/knowledge_graph_query_engine.html">Knowledge Graph Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/sql_query_engine.html">SQL Query Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/query_engines/pandas_query_engine.html">Pandas Query Engine</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api_reference/query/chat_engines.html">Chat Engines</a><input class="toctree-checkbox" id="toctree-checkbox-84" name="toctree-checkbox-84" role="switch" type="checkbox"/><label for="toctree-checkbox-84"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/chat_engines/simple_chat_engine.html">Simple Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/chat_engines/condense_question_chat_engine.html">Condense Question Chat Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/query/chat_engines/condense_plus_context_chat_engine.html">Condense Plus Context Chat Engine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/query/query_bundle.html">Query Bundle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/query/query_transform.html">Query Transform</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/readers.html">Data Connectors</a><input class="toctree-checkbox" id="toctree-checkbox-85" name="toctree-checkbox-85" role="switch" type="checkbox"/><label for="toctree-checkbox-85"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.download_loader.html">download_loader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.WikipediaReader.html">WikipediaReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.YoutubeTranscriptReader.html">YoutubeTranscriptReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.SimpleDirectoryReader.html">SimpleDirectoryReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.JSONReader.html">JSONReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.SimpleMongoReader.html">SimpleMongoReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.NotionPageReader.html">NotionPageReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.GoogleDocsReader.html">GoogleDocsReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.MetalReader.html">MetalReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.DiscordReader.html">DiscordReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.SlackReader.html">SlackReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.WeaviateReader.html">WeaviateReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.PineconeReader.html">PineconeReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.PsychicReader.html">PsychicReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.QdrantReader.html">QdrantReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.MilvusReader.html">MilvusReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.ChromaReader.html">ChromaReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.DeepLakeReader.html">DeepLakeReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.FaissReader.html">FaissReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.MyScaleReader.html">MyScaleReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.StringIterableReader.html">StringIterableReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.SimpleWebPageReader.html">SimpleWebPageReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.BeautifulSoupWebReader.html">BeautifulSoupWebReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.TrafilaturaWebReader.html">TrafilaturaWebReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.RssReader.html">RssReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.MakeWrapper.html">MakeWrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.TwitterTweetReader.html">TwitterTweetReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.ObsidianReader.html">ObsidianReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.GithubRepositoryReader.html">GithubRepositoryReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.MboxReader.html">MboxReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.ElasticsearchReader.html">ElasticsearchReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.SteamshipFileReader.html">SteamshipFileReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.ChatGPTRetrievalPluginReader.html">ChatGPTRetrievalPluginReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.BagelReader.html">BagelReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.HTMLTagReader.html">HTMLTagReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.ReaderConfig.html">ReaderConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.PDFReader.html">PDFReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/llama_index.readers.DashVectorReader.html">DashVectorReader</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/response.html">Response</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/service_context.html">Service Context</a><input class="toctree-checkbox" id="toctree-checkbox-86" name="toctree-checkbox-86" role="switch" type="checkbox"/><label for="toctree-checkbox-86"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html">Embeddings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#openaiembedding">OpenAIEmbedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#huggingfaceembedding">HuggingFaceEmbedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#optimumembedding">OptimumEmbedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#instructorembedding">InstructorEmbedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#langchainembedding">LangchainEmbedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#googleunivsentencoderembedding">GoogleUnivSentEncoderEmbedding</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api_reference/service_context/node_parser.html">Node Parser</a><input class="toctree-checkbox" id="toctree-checkbox-87" name="toctree-checkbox-87" role="switch" type="checkbox"/><label for="toctree-checkbox-87"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.get_leaf_nodes.html">get_leaf_nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.get_root_nodes.html">get_root_nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.TokenTextSplitter.html">TokenTextSplitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.SentenceSplitter.html">SentenceSplitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.CodeSplitter.html">CodeSplitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.SimpleFileNodeParser.html">SimpleFileNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.HTMLNodeParser.html">HTMLNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.MarkdownNodeParser.html">MarkdownNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.JSONNodeParser.html">JSONNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.SentenceWindowNodeParser.html">SentenceWindowNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.NodeParser.html">NodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.HierarchicalNodeParser.html">HierarchicalNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.TextSplitter.html">TextSplitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.MetadataAwareTextSplitter.html">MetadataAwareTextSplitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.LangchainNodeParser.html">LangchainNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.UnstructuredElementNodeParser.html">UnstructuredElementNodeParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.node_parser.SimpleNodeParser.html">SimpleNodeParser</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/service_context/prompt_helper.html">PromptHelper</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api_reference/llms.html">LLMs</a><input class="toctree-checkbox" id="toctree-checkbox-88" name="toctree-checkbox-88" role="switch" type="checkbox"/><label for="toctree-checkbox-88"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/openai.html">OpenAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/azure_openai.html">Azure OpenAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/huggingface.html">HuggingFaceLLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/langchain.html">LangChainLLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/anthropic.html">Anthropic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/gradient_base_model.html">Gradient Base Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/gradient_model_adapter.html">Gradient Model Adapter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/litellm.html">LiteLLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/llama_cpp.html">LlamaCPP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/palm.html">PaLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/predibase.html">Predibase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/replicate.html">Replicate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/xinference.html">XOrbits Xinference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api_reference/llms/openllm.html">OpenLLM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html">Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#openaiembedding">OpenAIEmbedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#huggingfaceembedding">HuggingFaceEmbedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#optimumembedding">OptimumEmbedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#instructorembedding">InstructorEmbedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#langchainembedding">LangchainEmbedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/service_context/embeddings.html#googleunivsentencoderembedding">GoogleUnivSentEncoderEmbedding</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api_reference/storage.html">Storage Context</a><input class="toctree-checkbox" id="toctree-checkbox-89" name="toctree-checkbox-89" role="switch" type="checkbox"/><label for="toctree-checkbox-89"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/storage/docstore.html">Document Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/storage/index_store.html">Index Store</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api_reference/storage/vector_store.html">Vector Store</a><input class="toctree-checkbox" id="toctree-checkbox-90" name="toctree-checkbox-90" role="switch" type="checkbox"/><label for="toctree-checkbox-90"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.ElasticsearchStore.html">ElasticsearchStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.SimpleVectorStore.html">SimpleVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.RedisVectorStore.html">RedisVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.RocksetVectorStore.html">RocksetVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.FaissVectorStore.html">FaissVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.PineconeVectorStore.html">PineconeVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.WeaviateVectorStore.html">WeaviateVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.QdrantVectorStore.html">QdrantVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.CassandraVectorStore.html">CassandraVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.ChromaVectorStore.html">ChromaVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.MetalVectorStore.html">MetalVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.OpensearchVectorStore.html">OpensearchVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.OpensearchVectorClient.html">OpensearchVectorClient</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.ChatGPTRetrievalPluginClient.html">ChatGPTRetrievalPluginClient</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.MilvusVectorStore.html">MilvusVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.DeepLakeVectorStore.html">DeepLakeVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.MyScaleVectorStore.html">MyScaleVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.LanceDBVectorStore.html">LanceDBVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.TairVectorStore.html">TairVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.DocArrayInMemoryVectorStore.html">DocArrayInMemoryVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.DocArrayHnswVectorStore.html">DocArrayHnswVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.SupabaseVectorStore.html">SupabaseVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.PGVectorStore.html">PGVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.PGVectoRsStore.html">PGVectoRsStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.TimescaleVectorStore.html">TimescaleVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.ZepVectorStore.html">ZepVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.AwaDBVectorStore.html">AwaDBVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.BagelVectorStore.html">BagelVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.Neo4jVectorStore.html">Neo4jVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.CognitiveSearchVectorStore.html">CognitiveSearchVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.EpsillaVectorStore.html">EpsillaVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.SingleStoreVectorStore.html">SingleStoreVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.VectorStoreQuery.html">VectorStoreQuery</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.VectorStoreQueryResult.html">VectorStoreQueryResult</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.MetadataFilters.html">MetadataFilters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.DashVectorStore.html">DashVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.TencentVectorDB.html">TencentVectorDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.AstraDBVectorStore.html">AstraDBVectorStore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.AzureCosmosDBMongoDBVectorSearch.html">AzureCosmosDBMongoDBVectorSearch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/llama_index.vector_stores.LanternVectorStore.html">LanternVectorStore</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/storage/kv_store.html">KV Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api_reference/storage/indices_save_load.html">Loading Indices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api_reference/struct_store.html">Structured Index Configuration</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../community/integrations.html">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-91" name="toctree-checkbox-91" role="switch" type="checkbox"/><label for="toctree-checkbox-91"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../community/llama_packs/root.html">Llama Packs 🦙📦</a><input class="toctree-checkbox" id="toctree-checkbox-92" name="toctree-checkbox-92" role="switch" type="checkbox"/><label for="toctree-checkbox-92"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../llama_hub/llama_packs_example.html">Llama Packs Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../llama_hub/llama_pack_resume.html">Llama Pack - Resume Screener 📄</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../module_guides/observability/observability.html">Observability</a><input class="toctree-checkbox" id="toctree-checkbox-93" name="toctree-checkbox-93" role="switch" type="checkbox"/><label for="toctree-checkbox-93"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/WandbCallbackHandler.html">Wandb Callback Handler</a></li>
<li class="toctree-l3"><a class="reference external" href="https://colab.research.google.com/github/Arize-ai/phoenix/blob/main/tutorials/tracing/llama_index_tracing_tutorial.ipynb">Arize Phoenix Tracing Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/OpenInferenceCallback.html">OpenInference Callback Handler + Arize Phoenix</a></li>
<li class="toctree-l3"><a class="reference external" href="https://colab.research.google.com/github/Arize-ai/phoenix/blob/main/tutorials/llama_index_search_and_retrieval_tutorial.ipynb">Evaluating Search and Retrieval with Arize Phoenix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../community/integrations/trulens.html">Evaluating and Tracking with TruLens</a></li>
<li class="toctree-l3"><a class="reference external" href="https://github.com/truera/trulens/blob/main/trulens_eval/examples/frameworks/llama_index/llama_index_quickstart.ipynb">Quickstart Guide with LlamaIndex + TruLens</a></li>
<li class="toctree-l3"><a class="reference external" href="https://colab.research.google.com/github/truera/trulens/blob/main/trulens_eval/examples/frameworks/llama_index/llama_index_quickstart.ipynb">Colab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../callbacks/HoneyHiveLlamaIndexTracer.html">HoneyHive LlamaIndex Tracer</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../module_guides/observability/callbacks/root.html">Callbacks</a><input class="toctree-checkbox" id="toctree-checkbox-94" name="toctree-checkbox-94" role="switch" type="checkbox"/><label for="toctree-checkbox-94"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../callbacks/TokenCountingHandler.html">Token Counting Handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../callbacks/LlamaDebugHandler.html">Llama Debug Handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../callbacks/WandbCallbackHandler.html">Wandb Callback Handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../callbacks/AimCallback.html">Aim Callback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../callbacks/OpenInferenceCallback.html">OpenInference Callback Handler + Arize Phoenix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../module_guides/observability/callbacks/token_counting_migration.html">Token Counting - Migration Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/graphsignal.html">Tracing with Graphsignal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/trulens.html">Evaluating and Tracking with TruLens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/deepeval.html">Unit Testing LLMs With DeepEval</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/guidance.html">Guidance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/lmformatenforcer.html">LM Format Enforcer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../output_parsing/GuardrailsDemo.html">Guardrails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../output_parsing/openai_pydantic_program.html">OpenAI Function Calling</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../community/integrations/vector_stores.html">Using Vector Stores</a><input class="toctree-checkbox" id="toctree-checkbox-95" name="toctree-checkbox-95" role="switch" type="checkbox"/><label for="toctree-checkbox-95"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/AstraDBIndexDemo.html">Astra DB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/AsyncIndexCreationDemo.html">Simple Vector Store - Async Index Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/AzureCosmosDBMongoDBvCoreDemo.html">Azure CosmosDB MongoDB Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CassandraIndexDemo.html">Cassandra Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ChromaIndexDemo.html">Chroma</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html">Azure Cognitive Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#basic-example">Basic Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#create-index-if-it-does-not-exist">Create Index (if it does not exist)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#use-existing-index">Use Existing Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#adding-a-document-to-existing-index">Adding a document to existing index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/CognitiveSearchIndexDemo.html#filtering">Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DashvectorIndexDemo.html">DashVector Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DeepLakeIndexDemo.html">DeepLake Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DocArrayHnswIndexDemo.html">DocArray Hnsw Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/DocArrayInMemoryIndexDemo.html">DocArray InMemory Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/EpsillaIndexDemo.html">Epsilla Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/LanceDBIndexDemo.html">LanceDB Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MetalIndexDemo.html">Metal Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MilvusIndexDemo.html">Milvus Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MyScaleIndexDemo.html">MyScale Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ElasticsearchIndexDemo.html">Elasticsearch Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/FaissIndexDemo.html">Faiss Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/MongoDBAtlasVectorSearch.html">MongoDB Atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/Neo4jVectorDemo.html">Neo4j vector store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/OpensearchDemo.html">Opensearch Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/PineconeIndexDemo.html">Pinecone Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/PineconeIndexDemo-Hybrid.html">Pinecone Vector Store - Hybrid Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/PGVectoRsDemo.html">pgvecto.rs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/postgres.html">Postgres Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RedisIndexDemo.html">Redis Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RedisIndexDemo.html#query-the-data">Query the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RedisIndexDemo.html#working-with-metadata">Working with Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/QdrantIndexDemo.html">Qdrant Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/RocksetIndexDemo.html">Rockset Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/SimpleIndexDemo.html">Simple Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/SupabaseVectorIndexDemo.html">Supabase Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/TairIndexDemo.html">Tair Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/TencentVectorDBIndexDemo.html">Tencent Cloud VectorDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/Timescalevector.html">Timescale Vector Store (PostgreSQL)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/WeaviateIndexDemo.html">Weaviate Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/WeaviateIndexDemo-Hybrid.html">Weaviate Vector Store - Hybrid Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ZepIndexDemo.html">Zep Vector Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ZepIndexDemo.html#create-a-zep-vector-store-and-index">Create a Zep Vector Store and Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vector_stores/ZepIndexDemo.html#querying-with-metadata-filters">Querying with Metadata filters</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../community/integrations/graph_stores.html">Using Graph Stores</a><input class="toctree-checkbox" id="toctree-checkbox-96" name="toctree-checkbox-96" role="switch" type="checkbox"/><label for="toctree-checkbox-96"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/Neo4jKGIndexDemo.html">Neo4j Graph Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/NebulaGraphKGIndexDemo.html">Nebula Graph Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_engine/knowledge_graph_query_engine.html">Knowledge Graph Query Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/KuzuGraphDemo.html">Kuzu Graph Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../index_structs/knowledge_graph/FalkorDBGraphDemo.html">FalkorDB Graph Store</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../community/integrations/managed_indices.html">Using Managed Indices</a><input class="toctree-checkbox" id="toctree-checkbox-97" name="toctree-checkbox-97" role="switch" type="checkbox"/><label for="toctree-checkbox-97"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../managed/vectaraDemo.html">Vectara Managed Index</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/using_with_langchain.html">Using with Langchain 🦜🔗</a></li>
<li class="toctree-l2"><a class="reference external" href="https://blog.streamlit.io/build-a-chatbot-with-custom-data-sources-powered-by-llamaindex/">Streamlit</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.chainlit.io/integrations/llama-index">Chainlit</a></li>
<li class="toctree-l2"><a class="reference external" href="https://www.anyscale.com/blog/build-and-scale-a-powerful-query-engine-with-llamaindex-ray">LlamaIndex + Ray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/chatgpt_plugins.html">ChatGPT Plugin Integrations</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/poe-platform/poe-protocol/tree/main/llama_poe">Poe</a></li>
<li class="toctree-l2"><a class="reference external" href="https://airbyte.com/tutorials/airbyte-and-llamaindex-elt-and-chat-with-your-data-warehouse-without-writing-sql">Airbyte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/integrations/fleet_libraries_context.html">Fleet Context Embeddings - Building a Hybrid Search Engine for the Llamaindex Library</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../community/frequently_asked_questions.html">Frequently Asked Questions (FAQ)</a><input class="toctree-checkbox" id="toctree-checkbox-98" name="toctree-checkbox-98" role="switch" type="checkbox"/><label for="toctree-checkbox-98"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../community/faq/llms.html">Large Language Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/faq/embeddings.html">Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/faq/vector_database.html">Vector Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/faq/query_engines.html">Query Engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/faq/chat_engines.html">Chat Engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/faq/documents_and_nodes.html">Documents and Nodes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/contributing.html">Contributing to LlamaIndex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/documentation.html">Documentation Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Changes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changes/changelog.html">ChangeLog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes/deprecated_terms.html">Deprecated Terms</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <p><a href="https://colab.research.google.com/github/run-llama/llama_index/blob/main/docs/examples/finetuning/cross_encoder_finetuning/cross_encoder_finetuning.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="section" id="how-to-finetune-a-cross-encoder-using-llamaindex">
<h1>How to Finetune a cross-encoder using LLamaIndex<a class="headerlink" href="#how-to-finetune-a-cross-encoder-using-llamaindex" title="Permalink to this heading"></a></h1>
<p>If you’re opening this Notebook on colab, you will probably need to install LlamaIndex 🦙.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>llama-index
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Requirements</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>datasets<span class="w"> </span>--quiet
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>sentence-transformers<span class="w"> </span>--quiet
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>openai<span class="w"> </span>--quiet
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">519.6/519.6 kB</span> <span class=" -Color -Color-Red">7.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">115.3/115.3 kB</span> <span class=" -Color -Color-Red">11.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">194.1/194.1 kB</span> <span class=" -Color -Color-Red">19.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">134.8/134.8 kB</span> <span class=" -Color -Color-Red">13.0 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">302.0/302.0 kB</span> <span class=" -Color -Color-Red">25.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">86.0/86.0 kB</span> <span class=" -Color -Color-Red">1.9 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h  Preparing metadata (setup.py) ... ?25l?25hdone
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">7.7/7.7 MB</span> <span class=" -Color -Color-Red">42.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">1.3/1.3 MB</span> <span class=" -Color -Color-Red">43.9 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">3.8/3.8 MB</span> <span class=" -Color -Color-Red">52.1 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">1.3/1.3 MB</span> <span class=" -Color -Color-Red">58.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">295.0/295.0 kB</span> <span class=" -Color -Color-Red">27.1 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h  Building wheel for sentence-transformers (setup.py) ... ?25l?25hdone
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">77.0/77.0 kB</span> <span class=" -Color -Color-Red">1.8 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h
</pre></div>
</div>
</div>
</div>
<div class="section" id="process">
<h2>Process<a class="headerlink" href="#process" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Download the QASPER Dataset from HuggingFace Hub using Datasets Library (https://huggingface.co/datasets/allenai/qasper)</p></li>
<li><p>From the train and test splits of the dataset extract 800 and 80 samples respectively</p></li>
<li><p>Use the 800 samples collected from train data which have the respective questions framed on a research paper to generate a dataset in the respective format required for CrossEncoder finetuning. Currently the format we use is that a single sample of fine tune data consists of two sentences(question and context) and a score either 0 or 1 where 1 shows that the question and context are relevant to each other and 0 shows they are not relevant to each other.</p></li>
<li><p>Use the 100 samples of test set to extract two kinds of evaluation datasets</p>
<ul>
<li><p>Rag Eval Dataset:-One dataset consists of samples where a single sample consists of a research paper content, list of questions on the research paper, answers of the list of questions on the research paper. While forming this dataset we keep only questions which have long answers/ free-form answers for better comparision with RAG generated answers.</p></li>
<li><p>Reranking Eval Dataset:- The other datasets consists of samples where a single sample consists of the research paper content, list of questions on the research paper, list of contexts from the research paper contents relevant to each question</p></li>
</ul>
</li>
<li><p>We finetuned the cross-encoder using helper utilities written in llamaindex and push it to HuggingFace Hub using the huggingface cli tokens login which can be found here:- https://huggingface.co/settings/tokens</p></li>
<li><p>We evaluate on both datasets using two metrics and three cases</p>
<ol class="arabic simple">
<li><p>Just OpenAI embeddings without any reranker</p></li>
<li><p>OpenAI embeddings combined with cross-encoder/ms-marco-MiniLM-L-12-v2 as reranker</p></li>
<li><p>OpenAI embeddings combined with our fine-tuned cross encoder model as reranker</p></li>
</ol>
</li>
</ul>
<ul class="simple">
<li><p>Evaluation Criteria for each Eval Dataset</p>
<ul>
<li><p>Hits metric:- For evaluating the Reranking Eval Dataset we just simply use the retriever+ post-processor functionalities of LLamaIndex to see in the different cases how many times does the relevant context gets retrieved and call it the hits metric.</p></li>
<li><p>Pairwise Comparision Evaluator:- We use the Pairwise Comparision Evaluator provided by LLamaIndex (https://github.com/run-llama/llama_index/blob/main/llama_index/evaluation/pairwise.py) to compare the responses of the respective query engines created in each case with the reference free-form answers provided.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="load-the-dataset">
<h2>Load the Dataset<a class="headerlink" href="#load-the-dataset" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">import</span> <span class="nn">random</span>


<span class="c1"># Download QASPER dataset from HuggingFace https://huggingface.co/datasets/allenai/qasper</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;allenai/qasper&quot;</span><span class="p">)</span>

<span class="c1"># Split the dataset into train, validation, and test splits</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
<span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># Set a random seed for reproducibility</span>

<span class="c1"># Randomly sample 800 rows from the training split</span>
<span class="n">train_sampled_indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)),</span> <span class="mi">800</span><span class="p">)</span>
<span class="n">train_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">train_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train_sampled_indices</span><span class="p">]</span>


<span class="c1"># Randomly sample 100 rows from the test split</span>
<span class="n">test_sampled_indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)),</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">test_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">test_sampled_indices</span><span class="p">]</span>

<span class="c1"># Now we have 800 research papers for training and 80 research papers to evaluate on</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="qasper-dataset">
<h2>QASPER Dataset<a class="headerlink" href="#qasper-dataset" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Each row has the below 6 columns</p>
<ul>
<li><p>id: Unique identifier of the research paper</p></li>
<li><p>title: Title of the Research paper</p></li>
<li><p>abstract: Abstract of the research paper</p></li>
<li><p>full_text: full text of the research paper</p></li>
<li><p>qas: Questions and answers pertaining to each research paper</p></li>
<li><p>figures_and_tables: figures and tables of each research paper</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get full text paper data , questions on the paper from training samples of QASPER to generate training dataset for cross-encoder finetuning</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="c1"># Utility function to get full-text of the research papers from the dataset</span>
<span class="k">def</span> <span class="nf">get_full_text</span><span class="p">(</span><span class="n">sample</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dict sample: the row sample from QASPER</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;abstract&quot;</span><span class="p">]</span>
    <span class="n">sections_list</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;full_text&quot;</span><span class="p">][</span><span class="s2">&quot;section_name&quot;</span><span class="p">]</span>
    <span class="n">paragraph_list</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;full_text&quot;</span><span class="p">][</span><span class="s2">&quot;paragraphs&quot;</span><span class="p">]</span>
    <span class="n">combined_sections_with_paras</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">paragraph_list</span><span class="p">):</span>
        <span class="n">combined_sections_with_paras</span> <span class="o">+=</span> <span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="n">combined_sections_with_paras</span> <span class="o">+=</span> <span class="n">abstract</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections_list</span><span class="p">)):</span>
            <span class="n">combined_sections_with_paras</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sections_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
            <span class="n">combined_sections_with_paras</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paragraph_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">combined_sections_with_paras</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not the same number of sections as paragraphs list&quot;</span><span class="p">)</span>


<span class="c1"># utility function to extract list of questions from the dataset</span>
<span class="k">def</span> <span class="nf">get_questions</span><span class="p">(</span><span class="n">sample</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dict sample: the row sample from QASPER</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">questions_list</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;qas&quot;</span><span class="p">][</span><span class="s2">&quot;question&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">questions_list</span>


<span class="n">doc_qa_dict_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">train_sample</span> <span class="ow">in</span> <span class="n">train_samples</span><span class="p">:</span>
    <span class="n">full_text</span> <span class="o">=</span> <span class="n">get_full_text</span><span class="p">(</span><span class="n">train_sample</span><span class="p">)</span>
    <span class="n">questions_list</span> <span class="o">=</span> <span class="n">get_questions</span><span class="p">(</span><span class="n">train_sample</span><span class="p">)</span>
    <span class="n">local_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;paper&quot;</span><span class="p">:</span> <span class="n">full_text</span><span class="p">,</span> <span class="s2">&quot;questions&quot;</span><span class="p">:</span> <span class="n">questions_list</span><span class="p">}</span>
    <span class="n">doc_qa_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">doc_qa_dict_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>800
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save training data as a csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">doc_qa_dict_list</span><span class="p">)</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;train.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generate-rag-eval-test-data">
<h3>Generate RAG Eval test data<a class="headerlink" href="#generate-rag-eval-test-data" title="Permalink to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get evaluation data papers , questions and answers</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The Answers field in the dataset follow the below format:-</span>
<span class="sd">Unanswerable answers have &quot;unanswerable&quot; set to true.</span>

<span class="sd">The remaining answers have exactly one of the following fields being non-empty.</span>

<span class="sd">&quot;extractive_spans&quot; are spans in the paper which serve as the answer.</span>
<span class="sd">&quot;free_form_answer&quot; is a written out answer.</span>
<span class="sd">&quot;yes_no&quot; is true iff the answer is Yes, and false iff the answer is No.</span>

<span class="sd">We accept only free-form answers and for all the other kind of answers we set their value to &#39;Unacceptable&#39;,</span>
<span class="sd">to better evaluate the performance of the query engine using pairwise comparision evaluator as it uses GPT-4 which is biased towards preferring long answers more.</span>
<span class="sd">https://www.anyscale.com/blog/a-comprehensive-guide-for-building-rag-based-llm-applications-part-1</span>

<span class="sd">So in the case of &#39;yes_no&#39; answers it can favour Query Engine answers more than reference answers.</span>
<span class="sd">Also in the case of extracted spans it can favour reference answers more than Query engine generated answers.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="n">eval_doc_qa_answer_list</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># Utility function to extract answers from the dataset</span>
<span class="k">def</span> <span class="nf">get_answers</span><span class="p">(</span><span class="n">sample</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param dict sample: the row sample from the train split of QASPER</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">final_answers_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;qas&quot;</span><span class="p">][</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
        <span class="n">local_answer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">types_of_answers</span> <span class="o">=</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">types_of_answers</span><span class="p">[</span><span class="s2">&quot;unanswerable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">types_of_answers</span><span class="p">[</span><span class="s2">&quot;free_form_answer&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">local_answer</span> <span class="o">=</span> <span class="n">types_of_answers</span><span class="p">[</span><span class="s2">&quot;free_form_answer&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">local_answer</span> <span class="o">=</span> <span class="s2">&quot;Unacceptable&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_answer</span> <span class="o">=</span> <span class="s2">&quot;Unacceptable&quot;</span>

        <span class="n">final_answers_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_answer</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_answers_list</span>


<span class="k">for</span> <span class="n">test_sample</span> <span class="ow">in</span> <span class="n">test_samples</span><span class="p">:</span>
    <span class="n">full_text</span> <span class="o">=</span> <span class="n">get_full_text</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>
    <span class="n">questions_list</span> <span class="o">=</span> <span class="n">get_questions</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>
    <span class="n">answers_list</span> <span class="o">=</span> <span class="n">get_answers</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>
    <span class="n">local_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;paper&quot;</span><span class="p">:</span> <span class="n">full_text</span><span class="p">,</span>
        <span class="s2">&quot;questions&quot;</span><span class="p">:</span> <span class="n">questions_list</span><span class="p">,</span>
        <span class="s2">&quot;answers&quot;</span><span class="p">:</span> <span class="n">answers_list</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">eval_doc_qa_answer_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">eval_doc_qa_answer_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>80
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save eval data as a csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">eval_doc_qa_answer_list</span><span class="p">)</span>
<span class="n">df_test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;test.csv&quot;</span><span class="p">)</span>

<span class="c1"># The Rag Eval test data can be found at the below dropbox link</span>
<span class="c1"># https://www.dropbox.com/scl/fi/3lmzn6714oy358mq0vawm/test.csv?rlkey=yz16080te4van7fvnksi9kaed&amp;dl=0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="generate-finetuning-dataset">
<h3>Generate Finetuning Dataset<a class="headerlink" href="#generate-finetuning-dataset" title="Permalink to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the latest version of llama-index</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>llama-index<span class="w"> </span>--quiet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the respective training dataset from the intial train data collected from QASPER in the format required by</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">SimpleDirectoryReader</span>
<span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">from</span> <span class="nn">llama_index.finetuning.cross_encoders.dataset_gen</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">generate_ce_fine_tuning_dataset</span><span class="p">,</span>
    <span class="n">generate_synthetic_queries_over_documents</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">llama_index.finetuning.cross_encoders.cross_encoder</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CrossEncoderFinetuneEngine</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-&quot;</span>
<span class="n">openai</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="n">final_finetuning_data_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">doc_qa_dict_list</span><span class="p">:</span>
    <span class="n">questions_list</span> <span class="o">=</span> <span class="n">paper</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">paper</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">])]</span>
    <span class="n">local_finetuning_dataset</span> <span class="o">=</span> <span class="n">generate_ce_fine_tuning_dataset</span><span class="p">(</span>
        <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
        <span class="n">questions_list</span><span class="o">=</span><span class="n">questions_list</span><span class="p">,</span>
        <span class="n">max_chunk_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">final_finetuning_data_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">local_finetuning_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total samples in the final fine-tuning dataset</span>
<span class="nb">len</span><span class="p">(</span><span class="n">final_finetuning_data_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11674
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save final fine-tuning dataset</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_finetuning_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final_finetuning_data_list</span><span class="p">)</span>
<span class="n">df_finetuning_dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;fine_tuning.csv&quot;</span><span class="p">)</span>

<span class="c1"># The finetuning dataset can be found at the below dropbox link:-</span>
<span class="c1"># https://www.dropbox.com/scl/fi/zu6vtisp1j3wg2hbje5xv/fine_tuning.csv?rlkey=0jr6fud8sqk342agfjbzvwr9x&amp;dl=0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load fine-tuning dataset</span>

<span class="n">finetuning_dataset</span> <span class="o">=</span> <span class="n">final_finetuning_data_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">finetuning_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CrossEncoderFinetuningDatasetSample(query=&#39;Do they repot results only on English data?&#39;, context=&#39;addition to precision, recall, and F1 scores for both tasks, we show the average of the F1 scores across both tasks. On the ADE dataset, we achieve SOTA results for both the NER and RE tasks. On the CoNLL04 dataset, we achieve SOTA results on the NER task, while our performance on the RE task is competitive with other recent models. On both datasets, we achieve SOTA results when considering the average F1 score across both tasks. The largest gain relative to the previous SOTA performance is on the RE task of the ADE dataset, where we see an absolute improvement of 4.5 on the macro-average F1 score.While the model of Eberts and Ulges eberts2019span outperforms our proposed architecture on the CoNLL04 RE task, their results come at the cost of greater model complexity. As mentioned above, Eberts and Ulges fine-tune the BERTBASE model, which has 110 million trainable parameters. In contrast, given the hyperparameters used for final training on the CoNLL04 dataset, our proposed architecture has approximately 6 million trainable parameters.The fact that the optimal number of task-specific layers differed between the two datasets demonstrates the&#39;, score=0)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="generate-reranking-eval-test-data">
<h3>Generate Reranking Eval test data<a class="headerlink" href="#generate-reranking-eval-test-data" title="Permalink to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download RAG Eval test data</span>
<span class="o">!</span>wget<span class="w"> </span>-O<span class="w"> </span>test.csv<span class="w"> </span>https://www.dropbox.com/scl/fi/3lmzn6714oy358mq0vawm/test.csv?rlkey<span class="o">=</span>yz16080te4van7fvnksi9kaed<span class="p">&amp;</span><span class="nv">dl</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate Reranking Eval Dataset from the Eval data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">ast</span>  <span class="c1"># Used to safely evaluate the string as a list</span>

<span class="c1"># Load Eval Data</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/content/test.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of papers in the test sample:- </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of papers in the test sample:- 80
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="n">final_eval_data_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">])]</span>
    <span class="n">query_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span>
    <span class="n">local_eval_dataset</span> <span class="o">=</span> <span class="n">generate_ce_fine_tuning_dataset</span><span class="p">(</span>
        <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
        <span class="n">questions_list</span><span class="o">=</span><span class="n">query_list</span><span class="p">,</span>
        <span class="n">max_chunk_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">relevant_query_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">relevant_context_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">local_eval_dataset</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">score</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">relevant_query_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
            <span class="n">relevant_context_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_query_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">final_eval_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;paper&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">],</span>
                <span class="s2">&quot;questions&quot;</span><span class="p">:</span> <span class="n">relevant_query_list</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">relevant_context_list</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Length of Reranking Eval Dataset</span>
<span class="nb">len</span><span class="p">(</span><span class="n">final_eval_data_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save Reranking eval dataset</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_finetuning_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final_eval_data_list</span><span class="p">)</span>
<span class="n">df_finetuning_dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;reranking_test.csv&quot;</span><span class="p">)</span>

<span class="c1"># The reranking dataset can be found at the below dropbox link</span>
<span class="c1"># https://www.dropbox.com/scl/fi/mruo5rm46k1acm1xnecev/reranking_test.csv?rlkey=hkniwowq0xrc3m0ywjhb2gf26&amp;dl=0</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="finetune-cross-encoder">
<h2>Finetune Cross-Encoder<a class="headerlink" href="#finetune-cross-encoder" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>huggingface_hub<span class="w"> </span>--quiet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">huggingface_hub</span> <span class="kn">import</span> <span class="n">notebook_login</span>

<span class="n">notebook_login</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1ed078bb7d4e49678ecfa42dc06a2398", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sentence_transformers</span> <span class="kn">import</span> <span class="n">SentenceTransformer</span>

<span class="c1"># Initialise the cross-encoder fine-tuning engine</span>
<span class="n">finetuning_engine</span> <span class="o">=</span> <span class="n">CrossEncoderFinetuneEngine</span><span class="p">(</span>
    <span class="n">dataset</span><span class="o">=</span><span class="n">finetuning_dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span>
<span class="p">)</span>

<span class="c1"># Finetune the cross-encoder model</span>
<span class="n">finetuning_engine</span><span class="o">.</span><span class="n">finetune</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "91f37d51eceb442885a371db97cf3381", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "c331e837ed604a9ba04acdd723e8ea89", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "7f6f2a6f61ad48c1a97bd2a5eb0bc26f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Push model to HuggingFace Hub</span>
<span class="n">finetuning_engine</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span>
    <span class="n">repo_id</span><span class="o">=</span><span class="s2">&quot;bpHigh/Cross-Encoder-LLamaIndex-Demo-v2&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4d836ead969d49d2b35a56483bf09889", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="reranking-evaluation">
<h2>Reranking Evaluation<a class="headerlink" href="#reranking-evaluation" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>nest-asyncio<span class="w"> </span>--quiet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># attach to the same event-loop</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>

<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Reranking test data</span>
<span class="o">!</span>wget<span class="w"> </span>-O<span class="w"> </span>reranking_test.csv<span class="w"> </span>https://www.dropbox.com/scl/fi/mruo5rm46k1acm1xnecev/reranking_test.csv?rlkey<span class="o">=</span>hkniwowq0xrc3m0ywjhb2gf26<span class="p">&amp;</span><span class="nv">dl</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2023-10-12 04:47:18--  https://www.dropbox.com/scl/fi/mruo5rm46k1acm1xnecev/reranking_test.csv?rlkey=hkniwowq0xrc3m0ywjhb2gf26
Resolving www.dropbox.com (www.dropbox.com)... 162.125.85.18, 2620:100:6035:18::a27d:5512
Connecting to www.dropbox.com (www.dropbox.com)|162.125.85.18|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://uc414efe80c7598407c86166866d.dl.dropboxusercontent.com/cd/0/inline/CFcxAwrNZkpcZLmEipK-DxnJF6BKMu8rKmoRp-FUoqRF83K1t0kG0OzBliY-8E7EmbRqkkRZENO4ayEUPgul8lzY7iyARc7kauQ4iHdGps9_Y4jHyuLstzxbVT1TDQyhotVUYWZ9uHNmDHI9UFWAKBVm/file# [following]
--2023-10-12 04:47:18--  https://uc414efe80c7598407c86166866d.dl.dropboxusercontent.com/cd/0/inline/CFcxAwrNZkpcZLmEipK-DxnJF6BKMu8rKmoRp-FUoqRF83K1t0kG0OzBliY-8E7EmbRqkkRZENO4ayEUPgul8lzY7iyARc7kauQ4iHdGps9_Y4jHyuLstzxbVT1TDQyhotVUYWZ9uHNmDHI9UFWAKBVm/file
Resolving uc414efe80c7598407c86166866d.dl.dropboxusercontent.com (uc414efe80c7598407c86166866d.dl.dropboxusercontent.com)... 162.125.80.15, 2620:100:6035:15::a27d:550f
Connecting to uc414efe80c7598407c86166866d.dl.dropboxusercontent.com (uc414efe80c7598407c86166866d.dl.dropboxusercontent.com)|162.125.80.15|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 967072 (944K) [text/plain]
Saving to: ‘reranking_test.csv’

reranking_test.csv  100%[===================&gt;] 944.41K  3.55MB/s    in 0.3s    

2023-10-12 04:47:19 (3.55 MB/s) - ‘reranking_test.csv’ saved [967072/967072]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Reranking Dataset</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">ast</span>

<span class="n">df_reranking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/content/reranking_test.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_reranking</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_reranking</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">df_reranking</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_reranking</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of papers in the reranking eval dataset:- </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_reranking</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of papers in the reranking eval dataset:- 38
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_reranking</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-e1282d93-cd7a-4536-a8a7-4f4ac8db179b" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>paper</th>
      <th>questions</th>
      <th>context</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Identifying Condition-Action Statements in Med...</td>
      <td>[What supervised machine learning models do th...</td>
      <td>[Identifying Condition-Action Statements in Me...</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-e1282d93-cd7a-4536-a8a7-4f4ac8db179b')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-e1282d93-cd7a-4536-a8a7-4f4ac8db179b button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-e1282d93-cd7a-4536-a8a7-4f4ac8db179b');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We evaluate by calculating hits for each (question, context) pair,</span>
<span class="c1"># we retrieve top-k documents with the question, and</span>
<span class="c1"># it’s a hit if the results contain the context</span>
<span class="kn">from</span> <span class="nn">llama_index.postprocessor</span> <span class="kn">import</span> <span class="n">SentenceTransformerRerank</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">VectorStoreIndex</span><span class="p">,</span>
    <span class="n">SimpleDirectoryReader</span><span class="p">,</span>
    <span class="n">ServiceContext</span><span class="p">,</span>
    <span class="n">Response</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.retrievers</span> <span class="kn">import</span> <span class="n">VectorIndexRetriever</span>
<span class="kn">from</span> <span class="nn">llama_index.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-&quot;</span>
<span class="n">openai</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span>

<span class="n">service_context_reranker_eval</span> <span class="o">=</span> <span class="n">ServiceContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">rerank_base</span> <span class="o">=</span> <span class="n">SentenceTransformerRerank</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;cross-encoder/ms-marco-MiniLM-L-12-v2&quot;</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">rerank_finetuned</span> <span class="o">=</span> <span class="n">SentenceTransformerRerank</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;bpHigh/Cross-Encoder-LLamaIndex-Demo-v2&quot;</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "34cf70bc3dbb48e2b1f1cf74836ec442", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "31993884af454bfa835dbaec8d0a0be1", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "bf39b437040f44af8bf41bf3d4a38a26", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "42fbc3d09200448f81651b5ddcd5e773", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "184ef6ea433747e9b2db933613db71ad", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "447733e06f7347a181624c40e859e46d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">without_reranker_hits</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">base_reranker_hits</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">finetuned_reranker_hits</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total_number_of_context</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_reranking</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">])]</span>
    <span class="n">query_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span>
    <span class="n">context_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">context_list</span><span class="p">)</span>
    <span class="n">vector_index</span> <span class="o">=</span> <span class="n">VectorStoreIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
        <span class="n">documents</span><span class="p">,</span> <span class="n">service_context</span><span class="o">=</span><span class="n">service_context_reranker_eval</span>
    <span class="p">)</span>

    <span class="n">retriever_without_reranker</span> <span class="o">=</span> <span class="n">vector_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
        <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">response_mode</span><span class="o">=</span><span class="s2">&quot;no_text&quot;</span>
    <span class="p">)</span>
    <span class="n">retriever_with_base_reranker</span> <span class="o">=</span> <span class="n">vector_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
        <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">response_mode</span><span class="o">=</span><span class="s2">&quot;no_text&quot;</span><span class="p">,</span>
        <span class="n">node_postprocessors</span><span class="o">=</span><span class="p">[</span><span class="n">rerank_base</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">retriever_with_finetuned_reranker</span> <span class="o">=</span> <span class="n">vector_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
        <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">response_mode</span><span class="o">=</span><span class="s2">&quot;no_text&quot;</span><span class="p">,</span>
        <span class="n">node_postprocessors</span><span class="o">=</span><span class="p">[</span><span class="n">rerank_finetuned</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">context_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">total_number_of_context</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">response_without_reranker</span> <span class="o">=</span> <span class="n">retriever_without_reranker</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">without_reranker_nodes</span> <span class="o">=</span> <span class="n">response_without_reranker</span><span class="o">.</span><span class="n">source_nodes</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">without_reranker_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
                <span class="n">without_reranker_hits</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">response_with_base_reranker</span> <span class="o">=</span> <span class="n">retriever_with_base_reranker</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">with_base_reranker_nodes</span> <span class="o">=</span> <span class="n">response_with_base_reranker</span><span class="o">.</span><span class="n">source_nodes</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">with_base_reranker_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
                <span class="n">base_reranker_hits</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">response_with_finetuned_reranker</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">retriever_with_finetuned_reranker</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">with_finetuned_reranker_nodes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">response_with_finetuned_reranker</span><span class="o">.</span><span class="n">source_nodes</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">with_finetuned_reranker_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
                <span class="n">finetuned_reranker_hits</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">with_finetuned_reranker_nodes</span><span class="p">)</span>
            <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">with_base_reranker_nodes</span><span class="p">)</span>
            <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">without_reranker_nodes</span><span class="p">)</span>
            <span class="o">==</span> <span class="mi">3</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this heading"></a></h3>
<p>As we can see below we get more hits with finetuned_cross_encoder compared to other options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">without_reranker_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">without_reranker_hits</span><span class="p">]</span>
<span class="n">base_reranker_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_reranker_hits</span><span class="p">]</span>
<span class="n">finetuned_reranker_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">finetuned_reranker_hits</span><span class="p">]</span>
<span class="n">reranker_eval_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Metric&quot;</span><span class="p">:</span> <span class="s2">&quot;Hits&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OpenAI_Embeddings&quot;</span><span class="p">:</span> <span class="n">without_reranker_scores</span><span class="p">,</span>
    <span class="s2">&quot;Base_cross_encoder&quot;</span><span class="p">:</span> <span class="n">base_reranker_scores</span><span class="p">,</span>
    <span class="s2">&quot;Finetuned_cross_encoder&quot;</span><span class="p">:</span> <span class="n">finetuned_reranker_hits</span><span class="p">,</span>
    <span class="s2">&quot;Total Relevant Context&quot;</span><span class="p">:</span> <span class="n">total_number_of_context</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">df_reranker_eval_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">reranker_eval_dict</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_reranker_eval_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Metric</th>
      <th>OpenAI_Embeddings</th>
      <th>Base_cross_encoder</th>
      <th>Finetuned_cross_encoder</th>
      <th>Total Relevant Context</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Hits</td>
      <td>30</td>
      <td>34</td>
      <td>37</td>
      <td>85</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="rag-evaluation">
<h2>RAG Evaluation<a class="headerlink" href="#rag-evaluation" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download RAG Eval test data</span>
<span class="o">!</span>wget<span class="w"> </span>-O<span class="w"> </span>test.csv<span class="w"> </span>https://www.dropbox.com/scl/fi/3lmzn6714oy358mq0vawm/test.csv?rlkey<span class="o">=</span>yz16080te4van7fvnksi9kaed<span class="p">&amp;</span><span class="nv">dl</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2023-10-12 04:47:36--  https://www.dropbox.com/scl/fi/3lmzn6714oy358mq0vawm/test.csv?rlkey=yz16080te4van7fvnksi9kaed
Resolving www.dropbox.com (www.dropbox.com)... 162.125.85.18, 2620:100:6035:18::a27d:5512
Connecting to www.dropbox.com (www.dropbox.com)|162.125.85.18|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://ucb6087b1b853dad24e8201987fc.dl.dropboxusercontent.com/cd/0/inline/CFfI9UezsVwFpN4CHgYrSFveuNE01DfczDaeFGZO-Ud5VdDRff1LNG7hEhkBZwVljuRde-EZU336ASpnZs32qVePvpQEFnKB2SeplFpMt50G0m5IZepyV6pYPbNAhm0muYE_rjhlolHxRUQP_iaJBX9z/file# [following]
--2023-10-12 04:47:38--  https://ucb6087b1b853dad24e8201987fc.dl.dropboxusercontent.com/cd/0/inline/CFfI9UezsVwFpN4CHgYrSFveuNE01DfczDaeFGZO-Ud5VdDRff1LNG7hEhkBZwVljuRde-EZU336ASpnZs32qVePvpQEFnKB2SeplFpMt50G0m5IZepyV6pYPbNAhm0muYE_rjhlolHxRUQP_iaJBX9z/file
Resolving ucb6087b1b853dad24e8201987fc.dl.dropboxusercontent.com (ucb6087b1b853dad24e8201987fc.dl.dropboxusercontent.com)... 162.125.80.15, 2620:100:6035:15::a27d:550f
Connecting to ucb6087b1b853dad24e8201987fc.dl.dropboxusercontent.com (ucb6087b1b853dad24e8201987fc.dl.dropboxusercontent.com)|162.125.80.15|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1821706 (1.7M) [text/plain]
Saving to: ‘test.csv’

test.csv            100%[===================&gt;]   1.74M  6.37MB/s    in 0.3s    

2023-10-12 04:47:38 (6.37 MB/s) - ‘test.csv’ saved [1821706/1821706]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">ast</span>  <span class="c1"># Used to safely evaluate the string as a list</span>

<span class="c1"># Load Eval Data</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/content/test.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of papers in the test sample:- </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of papers in the test sample:- 80
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at one sample of eval data which has a research paper questions on it and the respective reference answers</span>
<span class="n">df_test</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-8dd2786b-981d-4642-b009-9531bd14adde" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>paper</th>
      <th>questions</th>
      <th>answers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Identifying Condition-Action Statements in Med...</td>
      <td>[What supervised machine learning models do th...</td>
      <td>[Unacceptable, Unacceptable, 1470 sentences, U...</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-8dd2786b-981d-4642-b009-9531bd14adde')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-8dd2786b-981d-4642-b009-9531bd14adde button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-8dd2786b-981d-4642-b009-9531bd14adde');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<div class="section" id="baseline-evaluation">
<h3>Baseline Evaluation<a class="headerlink" href="#baseline-evaluation" title="Permalink to this heading"></a></h3>
<p>Just using OpenAI Embeddings for retrieval without any re-ranker</p>
<div class="section" id="eval-method">
<h4>Eval Method:-<a class="headerlink" href="#eval-method" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Iterate over each row of the test dataset:-</p>
<ol class="arabic simple">
<li><p>For the current row being iterated, create a vector index using the paper document provided in the paper column of the dataset</p></li>
<li><p>Query the vector index with a top_k value of top 3 nodes without any reranker</p></li>
<li><p>Compare the generated answers with the reference answers of the respective sample using Pairwise Comparison Evaluator and add the scores to a list</p></li>
</ol>
</li>
<li><p>Repeat 1 untill all the rows have been iterated</p></li>
<li><p>Calculate avg scores over all samples/ rows</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">VectorStoreIndex</span><span class="p">,</span>
    <span class="n">SimpleDirectoryReader</span><span class="p">,</span>
    <span class="n">ServiceContext</span><span class="p">,</span>
    <span class="n">Response</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">llama_index.evaluation</span> <span class="kn">import</span> <span class="n">PairwiseComparisonEvaluator</span>
<span class="kn">from</span> <span class="nn">llama_index.evaluation.eval_utils</span> <span class="kn">import</span> <span class="n">get_responses</span><span class="p">,</span> <span class="n">get_results_df</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-&quot;</span>
<span class="n">openai</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span>

<span class="n">gpt4</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span>
<span class="n">service_context_gpt4</span> <span class="o">=</span> <span class="n">ServiceContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">gpt4</span><span class="p">)</span>

<span class="n">evaluator_gpt4_pairwise</span> <span class="o">=</span> <span class="n">PairwiseComparisonEvaluator</span><span class="p">(</span>
    <span class="n">service_context</span><span class="o">=</span><span class="n">service_context_gpt4</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairwise_scores_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">no_reranker_dict_list</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># Iterate over the rows of the dataset</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">])]</span>
    <span class="n">query_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span>
    <span class="n">reference_answers_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span>
    <span class="n">number_of_accepted_queries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Create vector index for the current row being iterated</span>
    <span class="n">vector_index</span> <span class="o">=</span> <span class="n">VectorStoreIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Query the vector index with a top_k value of top 3 documents without any reranker</span>
    <span class="n">query_engine</span> <span class="o">=</span> <span class="n">vector_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span><span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_answers_list</span><span class="p">)</span>
    <span class="n">pairwise_local_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">reference_answers_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="o">!=</span> <span class="s2">&quot;Unacceptable&quot;</span><span class="p">:</span>
            <span class="n">number_of_accepted_queries</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query_engine</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

            <span class="n">no_reranker_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
                <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="n">reference</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">no_reranker_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">no_reranker_dict</span><span class="p">)</span>

            <span class="c1"># Compare the generated answers with the reference answers of the respective sample using</span>
            <span class="c1"># Pairwise Comparison Evaluator and add the scores to a list</span>

            <span class="n">pairwise_eval_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">evaluator_gpt4_pairwise</span><span class="o">.</span><span class="n">aevaluate</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span>
            <span class="p">)</span>

            <span class="n">pairwise_score</span> <span class="o">=</span> <span class="n">pairwise_eval_result</span><span class="o">.</span><span class="n">score</span>

            <span class="n">pairwise_local_score</span> <span class="o">+=</span> <span class="n">pairwise_score</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">number_of_accepted_queries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">avg_pairwise_local_score</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pairwise_local_score</span> <span class="o">/</span> <span class="n">number_of_accepted_queries</span>
        <span class="p">)</span>
        <span class="n">pairwise_scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_pairwise_local_score</span><span class="p">)</span>


<span class="n">overal_pairwise_average_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pairwise_scores_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">pairwise_scores_list</span>
<span class="p">)</span>

<span class="n">df_responses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">no_reranker_dict_list</span><span class="p">)</span>
<span class="n">df_responses</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;No_Reranker_Responses.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Without Reranker&quot;</span><span class="p">],</span>
    <span class="s2">&quot;pairwise score&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">overal_pairwise_average_score</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>pairwise score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Without Reranker</td>
      <td>0.553788</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="evaluate-with-base-reranker">
<h3>Evaluate with base reranker<a class="headerlink" href="#evaluate-with-base-reranker" title="Permalink to this heading"></a></h3>
<p>OpenAI Embeddings +  <code class="docutils literal notranslate"><span class="pre">cross-encoder/ms-marco-MiniLM-L-12-v2</span></code> as reranker</p>
<div class="section" id="id1">
<h4>Eval Method:-<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Iterate over each row of the test dataset:-</p>
<ol class="arabic simple">
<li><p>For the current row being iterated, create a vector index using the paper document provided in the paper column of the dataset</p></li>
<li><p>Query the vector index with a top_k value of top 5 nodes.</p></li>
<li><p>Use cross-encoder/ms-marco-MiniLM-L-12-v2 as a reranker as a NodePostprocessor to get top_k value of top 3 nodes out of the 8 nodes</p></li>
<li><p>Compare the generated answers with the reference answers of the respective sample using Pairwise Comparison Evaluator and add the scores to a list</p></li>
</ol>
</li>
<li><p>Repeat 1 untill all the rows have been iterated</p></li>
<li><p>Calculate avg scores over all samples/ rows</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">llama_index.postprocessor</span> <span class="kn">import</span> <span class="n">SentenceTransformerRerank</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">VectorStoreIndex</span><span class="p">,</span>
    <span class="n">SimpleDirectoryReader</span><span class="p">,</span>
    <span class="n">ServiceContext</span><span class="p">,</span>
    <span class="n">Response</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">llama_index.evaluation</span> <span class="kn">import</span> <span class="n">PairwiseComparisonEvaluator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">openai</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-&quot;</span>
<span class="n">openai</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span>

<span class="n">rerank</span> <span class="o">=</span> <span class="n">SentenceTransformerRerank</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;cross-encoder/ms-marco-MiniLM-L-12-v2&quot;</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">gpt4</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span>
<span class="n">service_context_gpt4</span> <span class="o">=</span> <span class="n">ServiceContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">gpt4</span><span class="p">)</span>

<span class="n">evaluator_gpt4_pairwise</span> <span class="o">=</span> <span class="n">PairwiseComparisonEvaluator</span><span class="p">(</span>
    <span class="n">service_context</span><span class="o">=</span><span class="n">service_context_gpt4</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "4cd72d8ca9ab45548335b59e673c1ab6", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "43fcf99b246e45dcab91746fdad3eb43", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "01f043960f8248b48f7db3dfe765bf7b", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "1c27a842b2964548898ca3f1152756b4", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "8ae5a97aea424b4a93d70b7a1e75c7f3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairwise_scores_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">base_reranker_dict_list</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c1"># Iterate over the rows of the dataset</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">])]</span>
    <span class="n">query_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span>
    <span class="n">reference_answers_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span>

    <span class="n">number_of_accepted_queries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Create vector index for the current row being iterated</span>
    <span class="n">vector_index</span> <span class="o">=</span> <span class="n">VectorStoreIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Query the vector index with a top_k value of top 8 nodes with reranker</span>
    <span class="c1"># as cross-encoder/ms-marco-MiniLM-L-12-v2</span>
    <span class="n">query_engine</span> <span class="o">=</span> <span class="n">vector_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
        <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">node_postprocessors</span><span class="o">=</span><span class="p">[</span><span class="n">rerank</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_answers_list</span><span class="p">)</span>
    <span class="n">pairwise_local_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">reference_answers_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="o">!=</span> <span class="s2">&quot;Unacceptable&quot;</span><span class="p">:</span>
            <span class="n">number_of_accepted_queries</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query_engine</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

            <span class="n">base_reranker_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
                <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="n">reference</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">base_reranker_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_reranker_dict</span><span class="p">)</span>

            <span class="c1"># Compare the generated answers with the reference answers of the respective sample using</span>
            <span class="c1"># Pairwise Comparison Evaluator and add the scores to a list</span>

            <span class="n">pairwise_eval_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">evaluator_gpt4_pairwise</span><span class="o">.</span><span class="n">aevaluate</span><span class="p">(</span>
                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span>
            <span class="p">)</span>

            <span class="n">pairwise_score</span> <span class="o">=</span> <span class="n">pairwise_eval_result</span><span class="o">.</span><span class="n">score</span>

            <span class="n">pairwise_local_score</span> <span class="o">+=</span> <span class="n">pairwise_score</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">number_of_accepted_queries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">avg_pairwise_local_score</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pairwise_local_score</span> <span class="o">/</span> <span class="n">number_of_accepted_queries</span>
        <span class="p">)</span>
        <span class="n">pairwise_scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_pairwise_local_score</span><span class="p">)</span>

<span class="n">overal_pairwise_average_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pairwise_scores_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">pairwise_scores_list</span>
<span class="p">)</span>

<span class="n">df_responses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">base_reranker_dict_list</span><span class="p">)</span>
<span class="n">df_responses</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Base_Reranker_Responses.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;With base cross-encoder/ms-marco-MiniLM-L-12-v2 as Reranker&quot;</span><span class="p">],</span>
    <span class="s2">&quot;pairwise score&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">overal_pairwise_average_score</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>pairwise score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>With base cross-encoder/ms-marco-MiniLM-L-12-v...</td>
      <td>0.556818</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="evaluate-with-fine-tuned-re-ranker">
<h3>Evaluate with Fine-Tuned re-ranker<a class="headerlink" href="#evaluate-with-fine-tuned-re-ranker" title="Permalink to this heading"></a></h3>
<p>OpenAI Embeddings + <code class="docutils literal notranslate"><span class="pre">bpHigh/Cross-Encoder-LLamaIndex-Demo-v2</span></code> as reranker</p>
<div class="section" id="id2">
<h4>Eval Method:-<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Iterate over each row of the test dataset:-</p>
<ol class="arabic simple">
<li><p>For the current row being iterated, create a vector index using the paper document provided in the paper column of the dataset</p></li>
<li><p>Query the vector index with a top_k value of top 5 nodes.</p></li>
<li><p>Use finetuned version of cross-encoder/ms-marco-MiniLM-L-12-v2 saved as bpHigh/Cross-Encoder-LLamaIndex-Demo as a reranker as a NodePostprocessor to get top_k value of top 3 nodes out of the 8 nodes</p></li>
<li><p>Compare the generated answers with the reference answers of the respective sample using Pairwise Comparison Evaluator and add the scores to a list</p></li>
</ol>
</li>
<li><p>Repeat 1 untill all the rows have been iterated</p></li>
<li><p>Calculate avg scores over all samples/ rows</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">llama_index.postprocessor</span> <span class="kn">import</span> <span class="n">SentenceTransformerRerank</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">VectorStoreIndex</span><span class="p">,</span>
    <span class="n">SimpleDirectoryReader</span><span class="p">,</span>
    <span class="n">ServiceContext</span><span class="p">,</span>
    <span class="n">Response</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">llama_index.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">llama_index</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">llama_index.evaluation</span> <span class="kn">import</span> <span class="n">PairwiseComparisonEvaluator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">openai</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-&quot;</span>
<span class="n">openai</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span>

<span class="n">rerank</span> <span class="o">=</span> <span class="n">SentenceTransformerRerank</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;bpHigh/Cross-Encoder-LLamaIndex-Demo-v2&quot;</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>


<span class="n">gpt4</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span>
<span class="n">service_context_gpt4</span> <span class="o">=</span> <span class="n">ServiceContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">gpt4</span><span class="p">)</span>

<span class="n">evaluator_gpt4_pairwise</span> <span class="o">=</span> <span class="n">PairwiseComparisonEvaluator</span><span class="p">(</span>
    <span class="n">service_context</span><span class="o">=</span><span class="n">service_context_gpt4</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairwise_scores_list</span> <span class="o">=</span> <span class="p">[]</span>


<span class="n">finetuned_reranker_dict_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate over the rows of the dataset</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;paper&quot;</span><span class="p">])]</span>
    <span class="n">query_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;questions&quot;</span><span class="p">]</span>
    <span class="n">reference_answers_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;answers&quot;</span><span class="p">]</span>

    <span class="n">number_of_accepted_queries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Create vector index for the current row being iterated</span>
    <span class="n">vector_index</span> <span class="o">=</span> <span class="n">VectorStoreIndex</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="c1"># Query the vector index with a top_k value of top 8 nodes with reranker</span>
    <span class="c1"># as cross-encoder/ms-marco-MiniLM-L-12-v2</span>
    <span class="n">query_engine</span> <span class="o">=</span> <span class="n">vector_index</span><span class="o">.</span><span class="n">as_query_engine</span><span class="p">(</span>
        <span class="n">similarity_top_k</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">node_postprocessors</span><span class="o">=</span><span class="p">[</span><span class="n">rerank</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_answers_list</span><span class="p">)</span>
    <span class="n">pairwise_local_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_list</span><span class="p">)):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">reference_answers_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">reference</span> <span class="o">!=</span> <span class="s2">&quot;Unacceptable&quot;</span><span class="p">:</span>
            <span class="n">number_of_accepted_queries</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">query_engine</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>

            <span class="n">finetuned_reranker_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
                <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span>
                <span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="n">reference</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">finetuned_reranker_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">finetuned_reranker_dict</span><span class="p">)</span>

            <span class="c1"># Compare the generated answers with the reference answers of the respective sample using</span>
            <span class="c1"># Pairwise Comparison Evaluator and add the scores to a list</span>

            <span class="n">pairwise_eval_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">evaluator_gpt4_pairwise</span><span class="o">.</span><span class="n">aevaluate</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span>
            <span class="p">)</span>

            <span class="n">pairwise_score</span> <span class="o">=</span> <span class="n">pairwise_eval_result</span><span class="o">.</span><span class="n">score</span>

            <span class="n">pairwise_local_score</span> <span class="o">+=</span> <span class="n">pairwise_score</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">number_of_accepted_queries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">avg_pairwise_local_score</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pairwise_local_score</span> <span class="o">/</span> <span class="n">number_of_accepted_queries</span>
        <span class="p">)</span>
        <span class="n">pairwise_scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_pairwise_local_score</span><span class="p">)</span>

<span class="n">overal_pairwise_average_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pairwise_scores_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">pairwise_scores_list</span>
<span class="p">)</span>
<span class="n">df_responses</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">finetuned_reranker_dict_list</span><span class="p">)</span>
<span class="n">df_responses</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Finetuned_Reranker_Responses.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;With fine-tuned cross-encoder/ms-marco-MiniLM-L-12-v2&quot;</span><span class="p">],</span>
    <span class="s2">&quot;pairwise score&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">overal_pairwise_average_score</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>pairwise score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>With fine-tuned cross-encoder/ms-marco-MiniLM-...</td>
      <td>0.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Results<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>As we can see we get the highest pairwise score with finetuned cross-encoder.</p>
<p>Although I would like to point that the reranking eval based on hits is a more robust metric compared to pairwise comparision evaluator as I have seen inconsistencies with the scores and there are also many inherent biases present when evaluating using GPT-4</p>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../rerankers/cohere_custom_reranker.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Custom Cohere Reranker</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../llm_judge/pairwise/finetune_llm_judge.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Knowledge Distillation For Fine-Tuning A GPT-3.5 Judge (Pairwise)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Jerry Liu
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">How to Finetune a cross-encoder using LLamaIndex</a><ul>
<li><a class="reference internal" href="#process">Process</a></li>
<li><a class="reference internal" href="#load-the-dataset">Load the Dataset</a></li>
<li><a class="reference internal" href="#qasper-dataset">QASPER Dataset</a><ul>
<li><a class="reference internal" href="#generate-rag-eval-test-data">Generate RAG Eval test data</a></li>
<li><a class="reference internal" href="#generate-finetuning-dataset">Generate Finetuning Dataset</a></li>
<li><a class="reference internal" href="#generate-reranking-eval-test-data">Generate Reranking Eval test data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#finetune-cross-encoder">Finetune Cross-Encoder</a></li>
<li><a class="reference internal" href="#reranking-evaluation">Reranking Evaluation</a><ul>
<li><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rag-evaluation">RAG Evaluation</a><ul>
<li><a class="reference internal" href="#baseline-evaluation">Baseline Evaluation</a><ul>
<li><a class="reference internal" href="#eval-method">Eval Method:-</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evaluate-with-base-reranker">Evaluate with base reranker</a><ul>
<li><a class="reference internal" href="#id1">Eval Method:-</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evaluate-with-fine-tuned-re-ranker">Evaluate with Fine-Tuned re-ranker</a><ul>
<li><a class="reference internal" href="#id2">Eval Method:-</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/js/mendablesearch.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.3.3/dist/umd/index.js"></script>
    <script defer="defer" src="../../../_static/js/algolia.js"></script>
    </body>
</html>